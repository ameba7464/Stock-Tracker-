# üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã:

1. **Its1_2_3/50g**: WB –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 98 –∑–∞–∫–∞–∑–æ–≤, Stock Tracker - 112 (—Ä–∞–∑–Ω–∏—Ü–∞ **+14.29%**)
2. **Its2/50g**: WB –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 72 –∑–∞–∫–∞–∑–∞, Stock Tracker - 80 (—Ä–∞–∑–Ω–∏—Ü–∞ **+11.11%**)
3. **Its2/50g+Aks5/20g**: WB –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 20 –∑–∞–∫–∞–∑–æ–≤, Stock Tracker - 22 (—Ä–∞–∑–Ω–∏—Ü–∞ **+10.00%**)

### ‚úÖ –•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å:
- **–û—Å—Ç–∞—Ç–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ 100%!**
- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∏–∫–µ –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞–∫–∞–∑–æ–≤

## üêõ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –≤ `group_data_by_product()`

**–§–∞–π–ª**: `src/stock_tracker/core/calculator.py`, —Å—Ç—Ä–æ–∫–∞ 644

```python
# Count total orders (—Ç–æ–ª—å–∫–æ –Ω–µ–æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ)
group["total_orders"] += 1  # ‚ùå –≠–¢–û –ü–û–õ–ï –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ –ø–æ–ª–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Product –æ–±—ä–µ–∫—Ç–æ–≤!

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –î–≤–æ–π–Ω–æ–π –ø–æ–¥—Å—á–µ—Ç –∑–∞–∫–∞–∑–æ–≤

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Product (—Å—Ç—Ä–æ–∫–∞ 700):
```python
# Set totals (recalculate_totals is called by add_warehouse)
```

Product –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç `total_orders` —á–µ—Ä–µ–∑ `recalculate_totals_from_warehouses()`:
```python
self.total_orders = sum(warehouse.orders for warehouse in self.warehouses)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –∫ —Å–∫–ª–∞–¥—É **–¥–≤–∞–∂–¥—ã**, –æ–Ω –±—É–¥–µ—Ç –ø–æ—Å—á–∏—Ç–∞–Ω **–¥–≤–∞–∂–¥—ã** –≤ –∏—Ç–æ–≥–µ!

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –í–æ–∑–º–æ–∂–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫–∞–∑–æ–≤

–í —Å—Ç—Ä–æ–∫–∞—Ö 600-642 —Ñ–∞–π–ª–∞ `calculator.py`:

```python
if is_marketplace:
    # ...
    group["warehouses"][warehouse_name]["orders"] += 1  # –°—á–∏—Ç–∞–µ–º –∑–∞–∫–∞–∑
    orders_processed += 1

elif is_real_warehouse(warehouse_name):
    # ...
    group["warehouses"][warehouse_name]["orders"] += 1  # –°—á–∏—Ç–∞–µ–º –∑–∞–∫–∞–∑ –µ—â–µ —Ä–∞–∑?
    orders_processed += 1

# –ò –ø–æ—Ç–æ–º –ï–©–ï –†–ê–ó:
group["total_orders"] += 1  # ‚ùå –¢—Ä–µ—Ç–∏–π —Ä–∞–∑?
```

## üéØ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: CSV –æ—Ç WB —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
WB CSV —Ñ–∞–π–ª —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç **—Å—É–º–º–∞—Ä–Ω—ã–µ** –∑–∞–∫–∞–∑—ã –ø–æ –ø–µ—Ä–∏–æ–¥—É (21-27 –æ–∫—Ç—è–±—Ä—è).
–ù–∞—à –∫–æ–¥ –º–æ–∂–µ—Ç:
1. –ß–∏—Ç–∞—Ç—å —Ç–µ –∂–µ –∑–∞–∫–∞–∑—ã –∏–∑ API (–∑–∞ —Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥)
2. –°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: **–¥–≤–æ–π–Ω–æ–π –ø–æ–¥—Å—á–µ—Ç**

### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: –ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è
- CSV: –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ 21-10-2025 –ø–æ 27-10-2025 (7 –¥–Ω–µ–π)
- API: –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –¥—Ä—É–≥–æ–π –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ —Å –¥—É–±–ª—è–º–∏

### –ì–∏–ø–æ—Ç–µ–∑–∞ 3: –ó–∞–∫–∞–∑—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
–ï—Å–ª–∏ –æ–¥–∏–Ω –∑–∞–∫–∞–∑ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ API –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞), –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å—á–∏—Ç–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

## üîß –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–æ–≤
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π
processed_order_ids = set()

for order in orders_data:
    order_id = order.get("gNumber")  # –∏–ª–∏ –¥—Ä—É–≥–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    
    if order_id in processed_order_ids:
        logger.warning(f"Duplicate order detected: {order_id}")
        continue
    
    processed_order_ids.add(order_id)
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

### –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ `group["total_orders"]`
–≠—Ç–æ –ø–æ–ª–µ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
logger.info(f"Processing {len(orders_data)} orders for {len(grouped_data)} products")
logger.info(f"Unique order IDs: {len(processed_order_ids)}")
logger.info(f"Orders per warehouse: {orders_processed}")
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö API
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ **—Ç–æ—á–Ω–æ –∑–∞ —Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥**, —á—Ç–æ –∏ CSV –æ—Ç WB.

### –®–∞–≥ 5: –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
```python
def test_no_order_duplication():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–∫–∞–∑—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è"""
    # –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –¥—É–±–ª—è–º–∏
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–∫–∞–∑–æ–≤
2. ‚è≥ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É `group_data_by_product()`
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–æ–≤
4. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
5. ‚è≥ –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω—É—é —Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ö–æ–¥–∫–∏

1. **–ü–æ–ª–µ `group["total_orders"]` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - —ç—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫
2. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–æ–≤** - –æ–¥–∏–Ω –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å—á–∏—Ç–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
3. **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö –∏ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –∑–∞–∫–∞–∑–æ–≤** - —Å—É–º–º–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º –º–æ–∂–µ—Ç != total_orders

