# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

## üìã –ó–∞–¥–∞—á–∏

### 1. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –∫–∞–∫ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º —Ç—ã—Å—è—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, `214,000`)

**–†–µ—à–µ–Ω–∏–µ:** 
- –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–ª–∞ –≤ `structure.py` —Å `"0.000"` –Ω–∞ `"0"` (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `apply_number_formatting()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –î–∞–Ω–Ω—ã–µ —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –≤ `formatter.py` —á–µ—Ä–µ–∑ `int(product.turnover)`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ `214` –≤–º–µ—Å—Ç–æ `214,000`

### 2. –£—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–æ–π –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å—é (‚â§14 –¥–Ω–µ–π)

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apply_turnover_conditional_formatting()` –≤ `structure.py`:

```python
def apply_turnover_conditional_formatting(self, worksheet: gspread.Worksheet) -> None:
    """
    Apply conditional formatting to the turnover column (E).
    
    Highlights cells in red when turnover is 14 days or less,
    indicating low stock that needs attention.
    """
```

**–ü—Ä–∞–≤–∏–ª–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **–£—Å–ª–æ–≤–∏–µ:** –ó–Ω–∞—á–µ–Ω–∏–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ ‚â§ 14 –¥–Ω–µ–π
- **–§–æ–Ω:** –ö—Ä–∞—Å–Ω—ã–π (`rgb(242, 51, 51)`)
- **–¢–µ–∫—Å—Ç:** –ë–µ–ª—ã–π, –∂–∏—Ä–Ω—ã–π
- **–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** –ö–æ –≤—Å–µ–π –∫–æ–ª–æ–Ω–∫–µ E (–Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 2)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –Ø—á–µ–π–∫–∏ —Å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å—é 14 –¥–Ω–µ–π –∏ –º–µ–Ω–µ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∫—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –≤ –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: `src/stock_tracker/database/structure.py`

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ (—Å—Ç—Ä–æ–∫–∞ ~94)
```python
# –ë–´–õ–û:
ColumnDefinition(
    key="turnover",
    header="–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å",
    letter="E",
    width=130,
    number_format="0.000",  # 3 decimal places
    alignment="CENTER"
)

# –°–¢–ê–õ–û:
ColumnDefinition(
    key="turnover",
    header="–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å",
    letter="E",
    width=130,
    number_format="0",  # –¶–µ–ª–æ–µ —á–∏—Å–ª–æ (–±–µ–∑ –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏)
    alignment="CENTER"
)
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ ~451)
```python
# –ë–´–õ–û:
turnover_format = {
    "numberFormat": {
        "type": "NUMBER",
        "pattern": "#,##0.000"
    }
}

# –°–¢–ê–õ–û:
turnover_format = {
    "numberFormat": {
        "type": "NUMBER",
        "pattern": "#,##0"
    }
}
```

#### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apply_turnover_conditional_formatting()` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ `apply_complete_formatting()`.

## üìä –ü—Ä–∏–º–µ—Ä—ã

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
–ê—Ä—Ç–∏–∫—É–ª    | –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å
-----------|----------------
Its2/50g   | 214,000
Its3/50g   | 12,000
Its4/50g   | 8,000
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
–ê—Ä—Ç–∏–∫—É–ª    | –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å
-----------|----------------
Its2/50g   | 214 (–æ–±—ã—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
Its3/50g   | 12  (üî¥ –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å!)
Its4/50g   | 8   (üî¥ –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å!)
```

## üéØ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

**–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å** = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ —Ö–≤–∞—Ç–∏—Ç —Ç–µ–∫—É—â–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º —Ç–µ–º–ø–µ –ø—Ä–æ–¥–∞–∂

- **‚â§ 14 –¥–Ω–µ–π (–∫—Ä–∞—Å–Ω—ã–π)** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å! –¢–æ–≤–∞—Ä –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–∞—è –∑–∞–∫—É–ø–∫–∞
- **15-30 –¥–Ω–µ–π (–æ–±—ã—á–Ω—ã–π)** - –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
- **> 30 –¥–Ω–µ–π (–æ–±—ã—á–Ω—ã–π)** - –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Å—Ç–∞—Ç–∫–æ–≤

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
1. –°–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å API
3. –í—ã–∑–æ–≤–µ `apply_complete_formatting()`

### –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```python
from stock_tracker.database.sheets import create_sheets_client
from stock_tracker.database.structure import create_table_structure

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç–∞–±–ª–∏—Ü–µ
client = create_sheets_client()
structure = create_table_structure(client)

# –ü–æ–ª—É—á–∏—Ç—å worksheet
worksheet = client._get_worksheet()

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
structure.apply_complete_formatting(worksheet)
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é: `python main.py`
2. –û—Ç–∫—Ä–æ–π—Ç–µ Google Sheets —Ç–∞–±–ª–∏—Ü—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–æ–Ω–∫—É E (–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å):
   - –ó–Ω–∞—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ –±–µ–∑ –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏
   - –ó–Ω–∞—á–µ–Ω–∏—è ‚â§14 –æ–∫—Ä–∞—à–µ–Ω—ã –≤ –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç —Å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- ‚úÖ `214` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- ‚úÖ `12` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫—Ä–∞—Å–Ω–æ–º —Ü–≤–µ—Ç–µ
- ‚úÖ `8` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫—Ä–∞—Å–Ω–æ–º —Ü–≤–µ—Ç–µ
- ‚úÖ `15` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º —Ü–≤–µ—Ç–æ–º

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –£—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–π –∫–æ–ª–æ–Ω–∫–µ E (–Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 2)
- –ü—Ä–∞–≤–∏–ª–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Google Sheets –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ï—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —É–¥–∞—Å—Ç—Å—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –±–µ–∑ –Ω–µ–≥–æ (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞)
- –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –≤—ã–±—Ä–∞–Ω –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∑–∞–º–µ—Ç–Ω–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/stock_tracker/database/structure.py` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `src/stock_tracker/core/formatter.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- `src/stock_tracker/services/product_service.py` - —Ä–∞—Å—á–µ—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏:
```python
if product.total_orders > 0:
    orders_per_day = product.total_orders / ORDER_LOOKBACK_DAYS  # 7 –¥–Ω–µ–π
    product.turnover = round(product.total_stock / orders_per_day, 3)
else:
    product.turnover = 0.0
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:**
- –û—Å—Ç–∞—Ç–∫–∏: 100 —à—Ç
- –ó–∞–∫–∞–∑—ã –∑–∞ 7 –¥–Ω–µ–π: 50 —à—Ç
- –ó–∞–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å: 50 / 7 = 7.14 —à—Ç/–¥–µ–Ω—å
- –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: 100 / 7.14 = **14 –¥–Ω–µ–π** üî¥

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º —Ç–µ–º–ø–µ –ø—Ä–æ–¥–∞–∂ —Ç–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π.
