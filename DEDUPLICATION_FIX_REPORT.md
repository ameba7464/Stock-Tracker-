# –û—Ç—á–µ—Ç –æ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ó–∞–∫–∞–∑–æ–≤

**–î–∞—Ç–∞:** 27 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´, –ß–ê–°–¢–ò–ß–ù–û –ü–†–û–í–ï–†–ï–ù–´

---

## üìã –°—É–º–º–∞—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ü—Ä–æ–±–ª–µ–º–∞
- **–°–∏–º–ø—Ç–æ–º**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –≤ Stock Tracker –Ω–∞ 10-14% –≤—ã—à–µ, —á–µ–º –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —ç–∫—Å–ø–æ—Ä—Ç–µ WB
- **–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ –º–µ—Ç–æ–¥–µ `group_data_by_product()`
- **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã**: 8 –∏–∑ 12 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è

### –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–í–Ω–µ—Å–µ–Ω—ã 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª `src/stock_tracker/core/calculator.py`:

#### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤** (—Å—Ç—Ä–æ–∫–∞ 495)
```python
processed_order_ids = set()  # –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
duplicate_orders_count = 0
```

#### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫–∞–∑–æ–≤** (—Å—Ç—Ä–æ–∫–∏ 575-595)
```python
# Skip duplicates
order_id = order.get("gNumber") or order.get("odid") or order.get("srid")
if order_id and order_id in processed_order_ids:
    duplicate_orders_count += 1
    logger.debug(f"Skipping duplicate order: {order_id}")
    continue

if order_id:
    processed_order_ids.add(order_id)
```

#### 3. **–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –ø–æ–ª—è** (—Å—Ç—Ä–æ–∫–∞ 660)
```python
# –£–¥–∞–ª–µ–Ω–æ: group["total_orders"] += 1
# –ü—Ä–∏—á–∏–Ω–∞: –≠—Ç–æ –ø–æ–ª–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å, Product –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ recalculate_totals_from_warehouses()
```

#### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∏ 670-710)
```python
# Validation: Compare warehouse sum with raw orders count
for key, group in grouped.items():
    warehouse_sum = sum(wh["orders"] for wh in group["warehouses"])
    raw_orders = len([o for o in orders_data 
                      if (o.get("supplierArticle") == key[0] and o.get("nmId") == key[1])])
    
    if warehouse_sum != raw_orders:
        logger.warning(f"Product {key[0]} (nmId={key[1]}): "
                      f"warehouse_sum={warehouse_sum} != raw_orders={raw_orders}")
```

#### 5. **–û—á–∏—Å—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** (—Å—Ç—Ä–æ–∫–∞ 490)
```python
# –£–¥–∞–ª–µ–Ω–æ: "total_orders": 0 –∏–∑ defaultdict
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –£—Å–ø–µ—à–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω—ã (3 –ø—Ä–æ–¥—É–∫—Ç–∞)
```
‚úÖ Its1_2_3/50g     - –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å—Ç—Ä–æ–∫–µ 2
‚úÖ Its2/50g         - –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å—Ç—Ä–æ–∫–µ 3  
‚úÖ ItsSport2/50g    - –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ —Å—Ç—Ä–æ–∫–µ 4
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ —ç—Ç–∞–ª–æ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º WB)

| –ê—Ä—Ç–∏–∫—É–ª | WB –ó–∞–∫–∞–∑–æ–≤ | WB –û—Å—Ç–∞—Ç–æ–∫ | –°—Ç–∞—Ç—É—Å |
|---------|------------|------------|--------|
| Its1_2_3/50g | 7 | 192 | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ |
| Its2/50g | 9 | 132 | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ |
| ItsSport2/50g | 5 | 185 | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ |

**–†–∞–Ω–µ–µ –≤ Stock Tracker –±—ã–ª–æ:**
- Its1_2_3/50g: 8 –∑–∞–∫–∞–∑–æ–≤ (+14.29%)
- Its2/50g: 10 –∑–∞–∫–∞–∑–æ–≤ (+11.11%)
- ItsSport2/50g: 6 –∑–∞–∫–∞–∑–æ–≤ (+20%)

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å:**
- Its1_2_3/50g: 7 –∑–∞–∫–∞–∑–æ–≤ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- Its2/50g: 9 –∑–∞–∫–∞–∑–æ–≤ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- ItsSport2/50g: 5 –∑–∞–∫–∞–∑–æ–≤ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 1. Google Sheets API Quota Exceeded
```
APIError: [429]: Quota exceeded for quota metric 'Read requests' and limit 
'Read requests per minute per user'
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É  
**–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 9 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏ +Aks –Ω–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã  
**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### 2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ö–æ–ª–æ–Ω–æ–∫ –¥–ª—è –ü—Ä–æ–¥—É–∫—Ç–æ–≤ +Aks
```
WARNING: Row 5: insufficient columns (5)
WARNING: Row 6: insufficient columns (5)
...
```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:**
- Its2/50g+Aks5/20g (—Å—Ç—Ä–æ–∫–∞ 5)
- Its1_2_3/50g+Aks5/20g (—Å—Ç—Ä–æ–∫–∞ 6)
- Its1_2_3/50g+Aks5/20g.FBS (—Å—Ç—Ä–æ–∫–∞ 7)
- ItsSport2/50g+Aks5/20g (—Å—Ç—Ä–æ–∫–∞ 8)
- Its1_2_3/50g+AksPoly/20g (—Å—Ç—Ä–æ–∫–∞ 9)

**–ü—Ä–∏—á–∏–Ω–∞**: –≠—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –∏–º–µ—é—Ç —É—Å—Ç–∞—Ä–µ–≤—à—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (5 –∫–æ–ª–æ–Ω–æ–∫ –≤–º–µ—Å—Ç–æ 8)  
**–†–µ—à–µ–Ω–∏–µ**: –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã

---

## üìä –í–∞–ª–∏–¥–∞—Ü–∏—è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –¢–µ—Å—Ç—ã
‚úÖ **test_warehouse_filtering.py** - 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ  
‚úÖ **test_stock_tracker_validation.py** - 1/1 —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω

### –õ–æ–≥–∏–∫–∞ –†–∞–±–æ—Ç—ã –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ Set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è**: `processed_order_ids = set()`
2. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∑–∞–∫–∞–∑–∞**: `order_id = gNumber or odid or srid`
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç**: `if order_id in processed_order_ids: continue`
4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Set**: `processed_order_ids.add(order_id)`
5. **–°—á–µ—Ç—á–∏–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: `duplicate_orders_count += 1` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –†–µ—à–µ–Ω–∏—è

‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: Set –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç O(1) –ø—Ä–æ–≤–µ—Ä–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏  
‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥ (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ ID)  
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤  
‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ù–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç —Ä–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ (–æ—Å—Ç–∞—Ç–∫–∏ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã)  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è warehouse_sum vs raw_orders

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –î–µ–π—Å—Ç–≤–∏—è

1. ‚è≥ **–ü–æ–¥–æ–∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Google Sheets API quota** (1-2 –º–∏–Ω—É—Ç—ã)
2. üîÅ **–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**:
   ```bash
   python run_full_sync.py
   ```

3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets**:
   - –û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É: https://docs.google.com/spreadsheets/d/1baGNbGKDSvFA1Cghh08onoG9PDGnO19UFzXhdKC9Sho
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 2-4 (Its1_2_3, Its2, ItsSport2)
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º WB

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¢–∞–±–ª–∏—Ü—ã**: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 5-9 –¥–æ 8 –∫–æ–ª–æ–Ω–æ–∫
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API –ó–∞–ø—Ä–æ—Å–æ–≤**: –í–Ω–µ–¥—Ä–∏—Ç—å batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ quota
3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ duplicate_orders_count –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç—å README —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π –≠—Ñ—Ñ–µ–∫—Ç

### –¢–æ—á–Ω–æ—Å—Ç—å –î–∞–Ω–Ω—ã—Ö
- **–ó–∞–∫–∞–∑—ã**: –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å WB API —Å–Ω–∏–∑–∏—Ç—Å—è —Å 10-14% –¥–æ 0%
- **–û—Å—Ç–∞—Ç–∫–∏**: –û—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ 100% —Ç–æ—á–Ω–æ—Å—Ç–∏ (–Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã)

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ë–∏–∑–Ω–µ—Å-–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
- ‚úÖ –¢–æ—á–Ω—ã–π —É—á–µ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ WB

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ `calculator.py`. –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ. –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–∏–ª–∞ 3 –ø—Ä–æ–¥—É–∫—Ç–∞ (–¥–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è API quota), —á—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è.

–ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è API quota –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –≤—Å–µ—Ö 12 –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

---

**–ê–≤—Ç–æ—Ä:** Stock Tracker Development Team  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-27
