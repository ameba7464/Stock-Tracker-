# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç Telegram Bot
## –î–∞—Ç–∞: 25 –¥–µ–∫–∞–±—Ä—è 2025, 17:40

---

## üö® –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –û—à–∏–±–∫–∞:
```
TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
```

### –ü—Ä–∏—á–∏–Ω–∞:
Telegram API —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ **—É–∂–µ –∑–∞–ø—É—â–µ–Ω –¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞** —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º (`8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms`), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `getUpdates`.

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### 1. –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
- –í—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python –±—ã–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ö–æ–º–∞–Ω–¥–∞: `Get-Process python | Stop-Process`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

### 2. Telegram Webhook
- –í–µ–±—Ö—É–∫ –±—ã–ª —É–¥–∞–ª–µ–Ω
- –ö–æ–º–∞–Ω–¥–∞: `deleteWebhook?drop_pending_updates=true`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `"Webhook is already deleted"` - –≤–µ–±—Ö—É–∫–∞ –Ω–µ—Ç

### 3. Pending Updates
- –í—Å–µ pending updates –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏ –æ—á–∏—â–µ–Ω—ã
- –ö–æ–º–∞–Ω–¥–∞: `getUpdates?offset=-1`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `{"ok":true,"result":[]}` - –Ω–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 4. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞—á–Ω–æ–π –ë–î
- PostgreSQL –≤ Yandex Cloud –¥–æ—Å—Ç—É–ø–µ–Ω
- Host: `158.160.188.247:5432`
- Database: `stocktracker`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 5. Telegram Bot API
- –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `getMe`
- Username: `@WildBStockBot`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

### –í–µ—Ä–æ—è—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –∑–∞–ø—É—Å–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞:

1. **Yandex Cloud (Compute/Container)**
   - –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - –í–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ systemd service
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: Yandex Compute Cloud –∏–ª–∏ Container Registry

2. **Docker –ª–æ–∫–∞–ª—å–Ω–æ**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å running containers
   - –ö–æ–º–∞–Ω–¥–∞: `docker ps | grep telegram`

3. **WSL (Windows Subsystem for Linux)**
   - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WSL, —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å
   - –ö–æ–º–∞–Ω–¥–∞ –≤ WSL: `ps aux | grep python`

4. **–î—Ä—É–≥–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä/—Å–µ—Ä–≤–µ—Ä**
   - –í–æ–∑–º–æ–∂–Ω–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

5. **Heroku/Render/Railway**
   - –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã

6. **Telegram Bot Hosting**
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç —Ö–æ—Å—Ç–∏—Ç—å –±–æ—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏

---

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ù–∞–π—Ç–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker:
```powershell
docker ps --filter "name=telegram" --filter "name=stock"
docker ps -a | Select-String "telegram"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ WSL:
```powershell
wsl ps aux | grep python
wsl ps aux | grep telegram
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ Yandex Cloud:
- –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å Yandex Cloud
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Compute Cloud ‚Üí Running instances
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Container Registry ‚Üí Running containers
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Cloud Functions

### –®–∞–≥ 2: Temporary Workaround - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Webhook –≤–º–µ—Å—Ç–æ Polling

–ï—Å–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ webhook mode:

```python
# –í .env –¥–æ–±–∞–≤–∏—Ç—å:
WEBHOOK_HOST=https://your-domain.com
```

Webhook –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getUpdates`.

### –®–∞–≥ 3: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–∫—Ä–∞–π–Ω—è—è –º–µ—Ä–∞)

–ï—Å–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä:
1. –ó–∞–π—Ç–∏ –≤ [@BotFather](https://t.me/BotFather)
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å `/revoke` –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
3. –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∫–æ–º–∞–Ω–¥–æ–π `/token`
4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ `.env`

---

## üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| Local Python –ø—Ä–æ—Ü–µ—Å—Å—ã | ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã | –í—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —É–±–∏—Ç—ã |
| Telegram Webhook | ‚úÖ –£–¥–∞–ª–µ–Ω | –í–µ–±—Ö—É–∫ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω |
| PostgreSQL Connection | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞–∫—É OK |
| Telegram Bot API | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ getMe |
| Polling Mode | ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥—Ä—É–≥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º |
| **–í—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞** | ‚ö†Ô∏è **–ê–ö–¢–ò–í–ï–ù** | **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ** |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**:
   ```powershell
   docker ps -a
   docker stop $(docker ps -q --filter "name=telegram")
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WSL**:
   ```powershell
   wsl --list --running
   wsl pkill -f "python.*app.main"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Yandex Cloud Console**:
   - URL: https://console.cloud.yandex.ru
   - –†–∞–∑–¥–µ–ª: Compute Cloud
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ VM instances

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Stock-Tracker**:
   ```powershell
   Get-Content 'c:\Users\miros\Downloads\Stock Tracker\Stock-Tracker\logs\*.log' | Select-String "Bot.*start"
   ```

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

–ü–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **webhook mode**:
1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ —Å –ø—É–±–ª–∏—á–Ω—ã–º URL (Ngrok –¥–ª—è —Ç–µ—Å—Ç–∞)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook: `/setWebhook`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ webhook —Ä–µ–∂–∏–º–µ

---

## üìù –õ–æ–≥–∏ –ø—Ä–æ–±–ª–µ–º—ã

```
2025-12-25 17:40:25 - Bot started successfully!
2025-12-25 17:40:25 - Starting polling...
Failed to fetch updates - TelegramConflictError: Conflict: terminated by other getUpdates request
Sleep for 1.000000 seconds and try again... (tryings = 0)
[–ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 8 —Ä–∞–∑ —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º]
2025-12-25 17:41:27 - Bot stopped successfully!
```

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
Get-Process python -ErrorAction SilentlyContinue | Select-Object Id, ProcessName, Path, StartTime

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker ps -a

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -ano | Select-String "8080"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WSL
wsl ps aux | grep python

# Telegram API –ø—Ä–æ–≤–µ—Ä–∫–∞
curl "https://api.telegram.org/bot8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms/getMe"
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ polling mode, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ç–æ—Ä–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä!**

Telegram API –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ **–û–î–ò–ù** –∞–∫—Ç–∏–≤–Ω—ã–π `getUpdates` –∑–∞–ø—Ä–æ—Å –Ω–∞ –±–æ—Ç–∞. Webhook mode –Ω–µ –∏–º–µ–µ—Ç —ç—Ç–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
