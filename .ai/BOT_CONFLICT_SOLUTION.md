# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ Telegram –±–æ—Ç–∞
## –î–∞—Ç–∞: 25 –¥–µ–∫–∞–±—Ä—è 2025

---

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

### –ü—Ä–∏—á–∏–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞:
–í **Yandex Cloud —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç production —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç polling mode –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `getUpdates`. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –≤—ã–∑—ã–≤–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç.

### –†–µ—à–µ–Ω–∏–µ:
**–û—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±–ª–∞—á–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –≤ Yandex Cloud.**

---

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
2. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –æ–±–ª–∞—á–Ω—ã–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º –±–æ—Ç–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather):
   ```
   /newbot
   –ù–∞–∑–≤–∞–Ω–∏–µ: WildBStockBot TEST
   Username: WildBStockBot_test
   ```

2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞

3. –°–æ–∑–¥–∞—Ç—å `.env.local` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
   ```env
   BOT_TOKEN=<test_bot_token>
   DATABASE_URL=sqlite+aiosqlite:///test.db
   ```

4. –ó–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:
   ```powershell
   cd 'c:\Users\miros\Downloads\Stock Tracker\Stock-Tracker\telegram-bot'
   .\.venv\Scripts\Activate.ps1
   copy .env.local .env
   python -m app.main
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ –±–æ—Ç–∞
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å production –±–æ—Ç–æ–º:

1. –ó–∞–π—Ç–∏ –≤ Yandex Cloud Console
2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VM/Container —Å –±–æ—Ç–æ–º
3. –ñ–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
5. **–ù–ï –ó–ê–ë–´–¢–¨** –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–ª–∞—á–Ω—ã–π –±–æ—Ç –æ–±—Ä–∞—Ç–Ω–æ!

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngrok –¥–ª—è webhook —Ä–µ–∂–∏–º–∞:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ngrok: `choco install ngrok` –∏–ª–∏ —Å–∫–∞—á–∞—Ç—å —Å https://ngrok.com
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å: `ngrok http 8080`
3. –ü–æ–ª—É—á–∏—Ç—å URL —Ç–∏–ø–∞ `https://xxxxx.ngrok.io`
4. –û–±–Ω–æ–≤–∏—Ç—å `.env`:
   ```env
   WEBHOOK_HOST=https://xxxxx.ngrok.io
   ```
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ - –æ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ webhook mode

---

## üåê Production –±–æ—Ç –≤ Yandex Cloud

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
- ‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ PostgreSQL: `158.160.188.247:5432/stocktracker`
- ‚úÖ –†–µ–∂–∏–º: Polling mode
- ‚úÖ Username: @WildBStockBot
- ‚úÖ ID: 8558236991

### –ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- Yandex Cloud (Compute Cloud –∏–ª–∏ Container Registry)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd –∏–ª–∏ Docker
- –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ Yandex Cloud Console

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–ª–∞—á–Ω—ã–π –±–æ—Ç:
1. –ó–∞–π—Ç–∏ –≤ Yandex Cloud Console: https://console.cloud.yandex.ru
2. –ù–∞–π—Ç–∏ VM –∏–ª–∏ Container —Å –±–æ—Ç–æ–º
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ Console
4. –°—Ç–∞—Ç—É—Å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π:
   ```bash
   ssh user@158.160.188.247
   systemctl status telegram-bot
   # –∏–ª–∏
   docker ps | grep telegram
   ```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

#### `.env` (Production - –ù–ï –ò–ó–ú–ï–ù–Ø–¢–¨):
```env
BOT_TOKEN=8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms
DATABASE_URL=postgresql+asyncpg://stocktracker:StockTracker2024@158.160.188.247:5432/stocktracker
```

#### `.env.local` (Development - —Å–æ–∑–¥–∞—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
```env
# –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
BOT_TOKEN=<your_test_bot_token>

# –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î
DATABASE_URL=sqlite+aiosqlite:///test_tgstock.db

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
GOOGLE_SHEET_URL=https://docs.google.com/spreadsheets/d/your_test_sheet
LOG_LEVEL=DEBUG
```

### –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `switch-env.ps1`:
```powershell
param(
    [Parameter(Mandatory=$true)]
    [ValidateSet('prod', 'dev')]
    [string]$Environment
)

$botPath = "c:\Users\miros\Downloads\Stock Tracker\Stock-Tracker\telegram-bot"
cd $botPath

if ($Environment -eq 'prod') {
    Copy-Item ".env.production" ".env" -Force
    Write-Host "Switched to PRODUCTION environment" -ForegroundColor Red
    Write-Host "WARNING: Make sure cloud bot is stopped!" -ForegroundColor Yellow
} else {
    Copy-Item ".env.local" ".env" -Force
    Write-Host "Switched to DEVELOPMENT environment" -ForegroundColor Green
}
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```powershell
.\switch-env.ps1 -Environment dev   # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
.\switch-env.ps1 -Environment prod  # –î–ª—è production (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:

1. **–ù–ï –ó–ê–ü–£–°–ö–ê–¢–¨** –ª–æ–∫–∞–ª—å–Ω–æ —Å production —Ç–æ–∫–µ–Ω–æ–º, –ø–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–ª–∞—á–Ω—ã–π –±–æ—Ç
2. **–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨** –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. **–ü–†–û–í–ï–†–Ø–¢–¨** —Å—Ç–∞—Ç—É—Å –æ–±–ª–∞—á–Ω–æ–≥–æ –±–æ—Ç–∞ –ø–µ—Ä–µ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º
4. **–°–û–ó–î–ê–¢–¨** `.env.local` —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
5. **–î–û–ë–ê–í–ò–¢–¨** `.env.local` –≤ `.gitignore`

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ API
Invoke-RestMethod -Uri "https://api.telegram.org/bot8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms/getMe" | ConvertTo-Json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
Invoke-RestMethod -Uri "https://api.telegram.org/bot8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms/getWebhookInfo" | ConvertTo-Json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
Invoke-RestMethod -Uri "https://api.telegram.org/bot8558236991:AAHFu2krkBMIWFKF6W_MkIYoIFbfw-d1kms/getUpdates?limit=1" | ConvertTo-Json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Python
Get-Process python -ErrorAction SilentlyContinue | Format-Table Id, ProcessName, StartTime
```

---

## üéì –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞** —á–µ—Ä–µ–∑ @BotFather
2. **–°–æ–∑–¥–∞—Ç—å `.env.local`** —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQLite** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (–±—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ)
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ** –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### –î–ª—è —Ä–∞–±–æ—Ç—ã —Å production:

1. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å** –æ–±–ª–∞—á–Ω–æ–≥–æ –±–æ—Ç–∞ –≤ Yandex Cloud Console
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** —á–µ—Ä–µ–∑ Console
3. **–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å** production –±–æ—Ç –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CI/CD** –¥–ª—è –¥–µ–ø–ª–æ—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚úÖ –ò—Ç–æ–≥:

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:** –û–±–ª–∞—á–Ω—ã–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Yandex Cloud. –í—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞.
