# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞ PostgreSQL –≤ Yandex Object Storage

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≤ Yandex Object Storage —Å —Ä–æ—Ç–∞—Ü–∏–µ–π —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –≤ Yandex Object Storage](#1-—Å–æ–∑–¥–∞–Ω–∏–µ-–±–∞–∫–µ—Ç–∞-–≤-yandex-object-storage)
2. [–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞](#2-–ø–æ–ª—É—á–µ–Ω–∏–µ-–∫–ª—é—á–µ–π-–¥–æ—Å—Ç—É–ø–∞)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–ó–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞](#4-–∑–∞–ø—É—Å–∫-–±—ç–∫–∞–ø–∞)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#5-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
6. [–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞](#6-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ-–∏–∑-–±—ç–∫–∞–ø–∞)
7. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](#7-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

---

## 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –≤ Yandex Object Storage

### –ß–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∫–∞—Ç–∞–ª–æ–≥ (folder)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Object Storage** ‚Üí **–ë–∞–∫–µ—Ç—ã**
4. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç**
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **–ò–º—è –±–∞–∫–µ—Ç–∞**: `stock-tracker-backups` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º)
   - **–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä**: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ª–∏–º–∏—Ç
   - **–î–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π
   - **–î–æ—Å—Ç—É–ø –∫ –ª–∏—Å—Ç–∏–Ω–≥—É –æ–±—ä–µ–∫—Ç–æ–≤**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π
   - **–ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ (–∏–ª–∏ –•–æ–ª–æ–¥–Ω–æ–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
6. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç**

### –ß–µ—Ä–µ–∑ CLI (yc):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Yandex Cloud CLI –µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

# –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
yc init

# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç
yc storage bucket create \
  --name stock-tracker-backups \
  --default-storage-class standard \
  --max-size 10737418240  # 10 GB
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Lifecycle Policy (–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤):

–í –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud:
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –±–∞–∫–µ—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª**
3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **–ü—Ä–µ—Ñ–∏–∫—Å**: `postgres/`
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –£–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã
   - **–ß–µ—Ä–µ–∑**: 7 –¥–Ω–µ–π

–ò–ª–∏ —á–µ—Ä–µ–∑ CLI:

```bash
cat > lifecycle.json << 'EOF'
{
  "rules": [
    {
      "id": "delete-old-backups",
      "enabled": true,
      "filter": {
        "prefix": "postgres/"
      },
      "expiration": {
        "days": 7
      }
    }
  ]
}
EOF

yc storage bucket update \
  --name stock-tracker-backups \
  --lifecycle-rules-from-file lifecycle.json
```

---

## 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
yc iam service-account create \
  --name stock-tracker-backup-sa \
  --description "Service account for PostgreSQL backups"

# –ü–æ–ª—É—á–∏—Ç–µ ID —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
SA_ID=$(yc iam service-account get stock-tracker-backup-sa --format json | jq -r '.id')

# –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å storage.editor
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role storage.editor \
  --subject serviceAccount:$SA_ID
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
yc iam access-key create \
  --service-account-name stock-tracker-backup-sa \
  --description "S3 access key for backups"
```

–í—ã–≤–æ–¥ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- `key_id` ‚Äî —ç—Ç–æ **S3_ACCESS_KEY**
- `secret` ‚Äî —ç—Ç–æ **S3_SECRET_KEY**

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `secret` —Å—Ä–∞–∑—É! –û–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# ================================
# Yandex Object Storage (S3) Backup
# ================================

# –ë–∞–∫–µ—Ç –¥–ª—è –±—ç–∫–∞–ø–æ–≤
S3_BACKUP_BUCKET=stock-tracker-backups

# –ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞)
S3_ACCESS_KEY=YCAJExxxxxxxxxxxxxxxxxx
S3_SECRET_KEY=YCxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—ç–∫–∞–ø–æ–≤
BACKUP_RETENTION_DAYS=7

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# TELEGRAM_BACKUP_CHAT_ID=123456789
```

---

## 4. –ó–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–ë—ç–∫–∞–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 03:00 (–ú–æ—Å–∫–≤–∞).

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–∫–ª—é—á–∞—è –±—ç–∫–∞–ø
docker-compose --profile backup up -d

# –ò–ª–∏ –∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±—ç–∫–∞–ø-—Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose --profile backup up -d backup backup-scheduler
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:

```bash
# –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞
docker-compose run --rm backup

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ postgres)
docker exec -it stock-tracker-postgres bash -c "
  export PGPASSWORD='stock_tracker_password'
  pg_dump -h localhost -U stock_tracker -d stock_tracker | gzip > /tmp/backup.sql.gz
"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—ç–∫–∞–ø –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ 03:00 –ø–æ –ú–æ—Å–∫–≤–µ. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:

```yaml
labels:
  # –§–æ—Ä–º–∞—Ç: —Å–µ–∫—É–Ω–¥—ã –º–∏–Ω—É—Ç—ã —á–∞—Å—ã –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏
  ofelia.job-run.backup.schedule: "0 0 3 * * *"  # 03:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  
  # –ü—Ä–∏–º–µ—Ä—ã –¥—Ä—É–≥–∏—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:
  # "0 30 2 * * *"   - 02:30 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  # "0 0 */6 * * *"  - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
  # "0 0 3 * * 0"    - 03:00 –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
```

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤ –≤ S3:

```bash
# –ß–µ—Ä–µ–∑ AWS CLI
aws s3 ls s3://stock-tracker-backups/postgres/ \
  --endpoint-url https://storage.yandexcloud.net

# –ß–µ—Ä–µ–∑ Yandex Cloud CLI
yc storage bucket list-objects stock-tracker-backups --prefix postgres/
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

```bash
# –õ–æ–≥–∏ –±—ç–∫–∞–ø-—Å–µ—Ä–≤–∏—Å–∞
docker logs stock-tracker-backup

# –õ–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
docker logs stock-tracker-backup-scheduler

# –õ–æ–≥–∏ –∏–∑ —Ñ–∞–π–ª–∞
cat logs/backup_postgres.log
```

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫:

```bash
# –ó–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞ —Å –≤—ã–≤–æ–¥–æ–º –≤ –∫–æ–Ω—Å–æ–ª—å
docker-compose run --rm backup
```

---

## 6. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞:

```bash
# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
aws s3 ls s3://stock-tracker-backups/postgres/ \
  --endpoint-url https://storage.yandexcloud.net

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
aws s3 cp s3://stock-tracker-backups/postgres/backup_stock_tracker_20241201_030000.sql.gz \
  ./backup.sql.gz \
  --endpoint-url https://storage.yandexcloud.net
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose stop api worker beat

# 2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –±—ç–∫–∞–ø
gunzip backup.sql.gz

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É
docker exec -i stock-tracker-postgres psql \
  -U stock_tracker \
  -d stock_tracker \
  < backup.sql

# 4. –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É —Å –Ω—É–ª—è
docker exec -i stock-tracker-postgres psql -U stock_tracker << 'EOF'
DROP DATABASE IF EXISTS stock_tracker;
CREATE DATABASE stock_tracker;
EOF

docker exec -i stock-tracker-postgres psql \
  -U stock_tracker \
  -d stock_tracker \
  < backup.sql

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose start api worker beat
```

### –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
./scripts/restore_postgres.sh s3://stock-tracker-backups/postgres/backup_stock_tracker_20241201_030000.sql.gz
```

---

## 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –±—ç–∫–∞–ø–∞ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_BACKUP_CHAT_ID=your_chat_id
```

–°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å:
- ‚úÖ –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –±—ç–∫–∞–ø–µ
- ‚ùå –ü—Ä–∏ –æ—à–∏–±–∫–µ –±—ç–∫–∞–ø–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Grafana:

–î–æ–±–∞–≤—å—Ç–µ –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—ç–∫–∞–ø–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –ò—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫

### –ê–ª–µ—Ä—Ç—ã:

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç –µ—Å–ª–∏:
- –ë—ç–∫–∞–ø –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –±–æ–ª–µ–µ 24 —á–∞—Å–æ–≤
- –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –í S3 –º–µ–Ω–µ–µ 3 –±—ç–∫–∞–ø–æ–≤

---

## üìä –°—Ç–æ–∏–º–æ—Å—Ç—å

–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Yandex Object Storage:

| –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | –¶–µ–Ω–∞ –∑–∞ –ì–ë/–º–µ—Å—è—Ü |
|-----------------|------------------|
| –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ     | ~1.19 ‚ÇΩ          |
| –•–æ–ª–æ–¥–Ω–æ–µ        | ~0.59 ‚ÇΩ          |

–î–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö 1 –ì–ë —Å 7 –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º–∏ –±—ç–∫–∞–ø–∞–º–∏:
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: ~7 –ì–ë √ó 1.19 ‚ÇΩ ‚âà **8.3 ‚ÇΩ/–º–µ—Å—è—Ü**
- **–û–ø–µ—Ä–∞—Ü–∏–∏**: ~210 PUT –æ–ø–µ—Ä–∞—Ü–∏–π √ó 0.0045 ‚ÇΩ ‚âà **1 ‚ÇΩ/–º–µ—Å—è—Ü**

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞ "Access Denied":
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
aws s3 ls s3://stock-tracker-backups/ --endpoint-url https://storage.yandexcloud.net

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
yc iam service-account get stock-tracker-backup-sa
```

### –û—à–∏–±–∫–∞ "Bucket not found":
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –±–∞–∫–µ—Ç–∞
yc storage bucket list
```

### –ë—ç–∫–∞–ø —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∂–∞—Ç–∏–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º
pg_dump ... | gzip -9 > backup.sql.gz

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ custom format
pg_dump -Fc -Z 9 ... > backup.dump
```

### –ë—ç–∫–∞–ø –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
docker logs stock-tracker-backup-scheduler

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç–∫–∏ (labels)
docker inspect stock-tracker-backup | jq '.[0].Config.Labels'
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
Stock-Tracker/
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ backup_postgres.sh      # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
‚îÇ   ‚îî‚îÄ‚îÄ restore_postgres.sh     # –°–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Dockerfile.backup           # Docker-–æ–±—Ä–∞–∑ –¥–ª—è –±—ç–∫–∞–ø–∞
‚îú‚îÄ‚îÄ docker-compose.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ .env                        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ Git!)
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –°–æ–∑–¥–∞–Ω –±–∞–∫–µ—Ç –≤ Yandex Object Storage
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω Lifecycle Policy –¥–ª—è –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏—è
- [ ] –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å —Ä–æ–ª—å—é `storage.editor`
- [ ] –ü–æ–ª—É—á–µ–Ω—ã –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞ (access key + secret key)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`
- [ ] –ó–∞–ø—É—â–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã backup –∏ backup-scheduler
- [ ] –ü—Ä–æ–≤–µ–¥—ë–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
