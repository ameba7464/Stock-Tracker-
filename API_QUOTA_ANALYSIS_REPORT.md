# üìä –û–¢–ß–Å–¢: –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –∫–≤–æ—Ç—ã Google Sheets API

**–î–∞—Ç–∞**: 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ read quota (60 requests/minute)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞, –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –î–ê–ù–ù–´–• –Ω–µ—Ç

---

## üîç EXECUTIVE SUMMARY

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:

‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –î–ê–ù–ù–´–• –Ω–µ—Ç** - –≤—Å–µ 11 —Ç–æ–≤–∞—Ä–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã, –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã  
‚ùå **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è API –í–´–ó–û–í–´** - 49 read requests –≤–º–µ—Å—Ç–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö 8  
üìä **–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: ~33 requests/minute (—Ñ–æ—Ä–º–∞–ª—å–Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 60/min)  
‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö –ª–µ–≥–∫–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç

### –í–µ—Ä–¥–∏–∫—Ç:

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –∫—Ä–∏—Ç–∏—á–Ω–∞**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ** (282 –∑–∞–∫–∞–∑–∞, 11 —Ç–æ–≤–∞—Ä–æ–≤)
- API –≤—ã–∑–æ–≤—ã **–∏–∑–±—ã—Ç–æ—á–Ω—ã–µ** –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ
- **84% –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** (49 ‚Üí 8 requests)

---

## üìà –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–í–û–¢–´

### –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–Ω–∞ 11 –ø—Ä–æ–¥—É–∫—Ç–æ–≤):

| –û–ø–µ—Ä–∞—Ü–∏—è | –ö–æ–ª-–≤–æ | –¢–∏–ø | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-----|-------------|
| **–ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** |
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | 1 | read | ‚úÖ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ |
| –û—Ç–∫—Ä—ã—Ç–∏–µ spreadsheet | 1 | read | ‚úÖ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ |
| –û—Ç–∫—Ä—ã—Ç–∏–µ worksheet | 1 | read | ‚úÖ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ |
| –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã | 2 | read | ‚úÖ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ |
| **–û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–¥—É–∫—Ç (√ó11)** |
| get_worksheet (read_product) | 11 | read | ‚ùå **–î–£–ë–õ–ò–ö–ê–¢ #1** |
| find_product_row (scan) | 11 | read | ‚ö†Ô∏è –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å |
| get_worksheet (create_product) | 11 | read | ‚ùå **–î–£–ë–õ–ò–ö–ê–¢ #2** |
| verify_structure | 11 | read | ‚ùå **–î–£–ë–õ–ò–ö–ê–¢ #3** |
| **–ò–¢–û–ì–û** | **49** | **read** | **–ú–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ 8** |

### –†–∞—Å—á—ë—Ç requests/minute:

```
49 requests –∑–∞ 90 —Å–µ–∫—É–Ω–¥ = 32.7 requests/minute
–õ–∏–º–∏—Ç: 60 requests/minute
–ó–∞–ø–∞—Å: 27.3 requests/minute (45%)
```

**–í—ã–≤–æ–¥**: –§–æ—Ä–º–∞–ª—å–Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–≤–æ—Ç—ã, –Ω–æ:
- ‚ö†Ô∏è –ó–∞–ø–∞—Å –º–∞–ª–µ–Ω—å–∫–∏–π (45%)
- ‚ö†Ô∏è –ü—Ä–∏ 20+ —Ç–æ–≤–∞—Ä–∞—Ö –ø—Ä–µ–≤—ã—Å–∏–º –ª–∏–º–∏—Ç
- ‚ö†Ô∏è Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã

---

## üêõ –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ get_or_create_worksheet() üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø

**–ì–¥–µ**: `operations.py:647` ‚Üí `create_or_update_product()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
```python
def create_or_update_product():
    # –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
    existing_product = self.read_product(...)  # ‚Üí get_worksheet() #1
    
    if existing_product:
        self.update_product(...)  # ‚Üí get_worksheet() #2 ‚ùå –î–£–ë–õ–ò–ö–ê–¢
    else:
        self.create_product(...)  # ‚Üí get_worksheet() #3 ‚ùå –î–£–ë–õ–ò–ö–ê–¢
```

**–í–ª–∏—è–Ω–∏–µ**: 
- 2 –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–¥—É–∫—Ç
- **22 –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–∞** –¥–ª—è 11 —Ç–æ–≤–∞—Ä–æ–≤
- **45% –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

**–†–µ—à–µ–Ω–∏–µ**:
```python
def create_or_update_product():
    worksheet = self.get_or_create_worksheet(...)  # –û–î–ò–ù –†–ê–ó
    existing_row = self._find_product_row(worksheet, ...)
    
    if existing_row:
        self._update_product_row(worksheet, existing_row, ...)
    else:
        self._append_product_row(worksheet, ...)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: find_product_row() —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å—é —Ç–∞–±–ª–∏—Ü—É ‚ö†Ô∏è –í–´–°–û–ö–ê–Ø

**–ì–¥–µ**: `operations.py` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `read_product()`, `create_product()`, `update_product()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
```python
def _find_product_row(worksheet, seller_article):
    all_values = worksheet.get_all_values()  # ‚Üê –ü–æ–ª–Ω—ã–π —Å–∫–∞–Ω!
    for i, row in enumerate(all_values):
        if row[0] == seller_article:
            return i + 1
    return None
```

**–í–ª–∏—è–Ω–∏–µ**:
- 11 –ø–æ–ª–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
- **11 –∑–∞–ø—Ä–æ—Å–æ–≤**, –∫–∞–∂–¥—ã–π —á–∏—Ç–∞–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ
- –†–∞—Å—Ç—ë—Ç –ª–∏–Ω–µ–π–Ω–æ —Å —Ä–∞–∑–º–µ—Ä–æ–º —Ç–∞–±–ª–∏—Ü—ã

**–†–µ—à–µ–Ω–∏–µ** (–≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω):

**–í–∞—Ä–∏–∞–Ω—Ç A: –ö—ç—à** (–±—ã—Å—Ç—Ä–æ)
```python
class SheetsOperations:
    def __init__(self):
        self._product_row_cache = {}  # seller_article ‚Üí row_number
    
    def _find_product_row_cached(self, worksheet, seller_article):
        if seller_article in self._product_row_cache:
            return self._product_row_cache[seller_article]
        
        row = self._find_product_row(worksheet, seller_article)
        if row:
            self._product_row_cache[seller_article] = row
        return row
    
    def clear_cache(self):
        self._product_row_cache = {}
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Batch read** (–Ω–∞–¥—ë–∂–Ω–µ–µ)
```python
def _find_products_batch(worksheet, seller_articles: List[str]):
    """–ù–∞–π—Ç–∏ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º"""
    all_values = worksheet.get_all_values()  # –û–î–ò–ù —Å–∫–∞–Ω –¥–ª—è –≤—Å–µ—Ö
    
    result = {}
    for i, row in enumerate(all_values):
        if row and row[0] in seller_articles:
            result[row[0]] = i + 1
    
    return result
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ #3: verify_worksheet_structure() –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ append ‚ö†Ô∏è –í–´–°–û–ö–ê–Ø

**–ì–¥–µ**: `operations.py` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `create_product()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
```python
def create_product():
    # ... —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
    worksheet.update(range_name, [row_data])
    
    # –ü–æ–ø—ã—Ç–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—á–∞—Å—Ç–æ –ø–∞–¥–∞–µ—Ç —Å quota error)
    try:
        self.verify_worksheet_structure(...)  # ‚ùå –õ–∏—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    except:
        pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
```

**–í–ª–∏—è–Ω–∏–µ**:
- 11 –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **11 –∑–∞–ø—Ä–æ—Å–æ–≤**
- –ß–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ quota errors (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö)

**–†–µ—à–µ–Ω–∏–µ**:
```python
def sync_from_api_to_sheets():
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –û–î–ò–ù –†–ê–ó –≤ –Ω–∞—á–∞–ª–µ
    self.verify_worksheet_structure(...)
    
    # –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
    for product in products:
        self.create_product(...)  # –ë–ï–ó verify
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ #4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch operations üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø

**–ì–¥–µ**: `product_service.py:380-400` ‚Üí —Ü–∏–∫–ª `for api_record in api_data`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
```python
for api_record in api_data:  # 11 –∏—Ç–µ—Ä–∞—Ü–∏–π
    product = self._convert_api_record_to_product(...)
    
    self.operations.create_or_update_product(...)  # ‚Üê –û—Ç–¥–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤!
    # = 4 read requests –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–¥—É–∫—Ç
```

**–í–ª–∏—è–Ω–∏–µ**:
- 11 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ 1 batch
- **44 –∑–∞–ø—Ä–æ—Å–∞** –≤–º–µ—Å—Ç–æ ~5

**–†–µ—à–µ–Ω–∏–µ**:

**–®–ê–ì 1**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `create_products_batch()`:
```python
# –í–º–µ—Å—Ç–æ:
for api_record in api_data:
    product = convert(api_record)
    self.operations.create_or_update_product(...)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
products = [convert(record) for record in api_data]
self.operations.create_products_batch(
    spreadsheet_id,
    products,
    worksheet_name
)
```

**–®–ê–ì 2**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `create_products_batch()`:
```python
def create_products_batch(self, spreadsheet_id, products, worksheet_name):
    worksheet = self.get_or_create_worksheet(...)  # –û–î–ò–ù –†–ê–ó
    
    # –û–î–ò–ù —Å–∫–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    existing_articles = set(self._get_all_seller_articles(worksheet))
    
    # –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
    new_products = [p for p in products if p.seller_article not in existing_articles]
    
    # –û–î–ò–ù batch append –¥–ª—è –≤—Å–µ—Ö
    if new_products:
        rows = [self.formatter.format_product_for_sheets(p) for p in new_products]
        next_row = self._find_next_empty_row(worksheet)
        worksheet.append_rows(rows)  # ‚Üê BATCH!
    
    return len(new_products)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ #5: –õ–∏—à–Ω–∏–µ read_product() –ø–æ—Å–ª–µ clear_all_products() üìù –°–†–ï–î–ù–Ø–Ø

**–ì–¥–µ**: `operations.py:647` ‚Üí `create_or_update_product()` –≤—ã–∑—ã–≤–∞–µ—Ç `read_product()`

**–ö–æ–Ω—Ç–µ–∫—Å—Ç**:
```python
# update_table_fixed.py
operations.clear_all_products(...)  # –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞!

# –ü–æ—Ç–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞:
operations.create_or_update_product(...)  # –ó–∞—á–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ?
    ‚îî‚Üí read_product(...)  # ‚Üê 100% –≤–µ—Ä–Ω—ë—Ç None (—Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞!)
       ‚îî‚Üí create_product(...)
```

**–í–ª–∏—è–Ω–∏–µ**:
- 11 –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã—Ö read_product() –≤—ã–∑–æ–≤–æ–≤
- **22 –∑–∞–ø—Ä–æ—Å–∞** (get_worksheet + find_row)
- **45% –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –ü–æ—Å–ª–µ clear_all_products() –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π create
operations.clear_all_products(...)

for product in products:
    operations.create_product(...)  # –ù–∞–ø—Ä—è–º—É—é, –±–µ–∑ read_product
```

–ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥:
```python
def create_or_update_product(self, ..., skip_existence_check=False):
    if not skip_existence_check:
        existing_product = self.read_product(...)
    else:
        # –°—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º
        return self.create_product(...)
```

---

## üìä –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|-------------------|-----------|
| Read requests (11 —Ç–æ–≤–∞—Ä–æ–≤) | 49 | 8 | **-84%** |
| Requests/minute | 32.7 | 5.3 | **-84%** |
| –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | 90 —Å–µ–∫ | 15 —Å–µ–∫ | **-83%** |
| –ó–∞–ø–∞—Å –¥–æ –ª–∏–º–∏—Ç–∞ (60/min) | 45% | 91% | **+102%** |
| –ú–∞–∫—Å —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è | 18 | 113 | **+528%** |

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 —á–∞—Å–∞) üî•

**1.1. –£–±—Ä–∞—Ç—å verify_worksheet_structure() –∏–∑ create_product()**
- **–§–∞–π–ª**: `src/stock_tracker/database/operations.py`
- **–°—Ç—Ä–æ–∫–∞**: ~250 (–≤–Ω—É—Ç—Ä–∏ create_product)
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤
- **–≠—Ñ—Ñ–µ–∫—Ç**: -11 requests, -22%

**1.2. –î–æ–±–∞–≤–∏—Ç—å skip_existence_check —Ñ–ª–∞–≥**
- **–§–∞–π–ª**: `src/stock_tracker/database/operations.py:647`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ `create_or_update_product()`
- **–≠—Ñ—Ñ–µ–∫—Ç**: -22 requests, -45%

**1.3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ update_table_fixed.py**
- **–§–∞–π–ª**: `update_table_fixed.py`
- **–î–µ–π—Å—Ç–≤–∏–µ**:
  ```python
  operations.clear_all_products(...)
  
  for product in products:
      operations.create_or_update_product(
          ..., 
          skip_existence_check=True  # ‚Üê –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
      )
  ```
- **–≠—Ñ—Ñ–µ–∫—Ç**: –°—Ä–∞–∑—É -33 requests (-67%)

### –§–∞–∑–∞ 2: –°—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (3-4 —á–∞—Å–∞) ‚ö†Ô∏è

**2.1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à worksheet**
- **–§–∞–π–ª**: `src/stock_tracker/services/product_service.py`
- **–î–µ–π—Å—Ç–≤–∏–µ**:
  ```python
  async def sync_from_api_to_sheets(self):
      # –ü–æ–ª—É—á–∏—Ç—å worksheet –û–î–ò–ù –†–ê–ó
      worksheet = self.operations.get_or_create_worksheet(...)
      
      # –ü–µ—Ä–µ–¥–∞—Ç—å –≤–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
      for product in products:
          self.operations.create_product_direct(worksheet, product)
  ```
- **–≠—Ñ—Ñ–µ–∫—Ç**: -11 requests, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -22%

**2.2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å _find_products_batch()**
- **–§–∞–π–ª**: `src/stock_tracker/database/operations.py`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è batch –ø–æ–∏—Å–∫–∞
- **–≠—Ñ—Ñ–µ–∫—Ç**: -10 requests (1 —Å–∫–∞–Ω –≤–º–µ—Å—Ç–æ 11)

### –§–∞–∑–∞ 3: –ì–ª—É–±–æ–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (8+ —á–∞—Å–æ–≤) üìù

**3.1. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ batch operations**
- **–§–∞–π–ª—ã**: 
  - `src/stock_tracker/services/product_service.py:380-400`
  - `src/stock_tracker/database/operations.py:275-340`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `create_products_batch()` –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ò—Ç–æ–≥–æ–≤—ã–µ 8 requests –≤–º–µ—Å—Ç–æ 49

**3.2. –î–æ–±–∞–≤–∏—Ç—å batch update –¥–ª—è Google Sheets**
- **–§–∞–π–ª**: `src/stock_tracker/database/operations.py`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `worksheet.batch_update()` –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `update()`
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ï—â—ë –±—ã—Å—Ç—Ä–µ–µ, –º–µ–Ω—å—à–µ latency

---

## üí° –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï (–ø–æ–∫–∞ –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–°–ï–ô–ß–ê–°** –∏–∑–±–µ–∂–∞—Ç—å quota errors:

```python
# update_table_fixed.py

import time

async def update_table_data_async(...):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    for i, product in enumerate(products):
        sync_session = await product_service.sync_from_api_to_sheets()
        
        # –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ 5-–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
        if (i + 1) % 5 == 0:
            print(f"‚è∏Ô∏è  –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ {i+1} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –∫–≤–æ—Ç—ã...")
            time.sleep(10)  # 10 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏
```

**–≠—Ñ—Ñ–µ–∫—Ç**: –†–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç 11 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ 2 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 1.5 –º–∏–Ω—É—Ç = –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–≤–æ—Ç—ã.

---

## üìã –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–§–∞–∑–∞ 1):
- [ ] –£–¥–∞–ª–∏—Ç—å `verify_worksheet_structure()` –∏–∑ `create_product()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `skip_existence_check` –ø–∞—Ä–∞–º–µ—Ç—Ä
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `update_table_fixed.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—É (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~16 requests –≤–º–µ—Å—Ç–æ 49)

### –í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ (–§–∞–∑–∞ 2):
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à worksheet
- [ ] –î–æ–±–∞–≤–∏—Ç—å `_find_products_batch()`
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `create_or_update_product()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å 20+ —Ç–æ–≤–∞—Ä–∞–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—É (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~10 requests)

### –í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ (–§–∞–∑–∞ 3):
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ `create_products_batch()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å batch update –≤ Google Sheets
- [ ] –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ó–∞–º–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ùå 49 read requests –∑–∞ 90 —Å–µ–∫—É–Ω–¥
- ‚ùå 32.7 requests/minute
- ‚ùå –ó–∞–ø–∞—Å 45% (–ª–µ–≥–∫–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ø—Ä–∏ –ø–∏–∫–∞—Ö)
- ‚ùå –ú–∞–∫—Å 18 —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è

### –ü–æ—Å–ª–µ –§–∞–∑—ã 1 (–±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
- ‚úÖ 16 read requests –∑–∞ 90 —Å–µ–∫—É–Ω–¥
- ‚úÖ 10.7 requests/minute
- ‚úÖ –ó–∞–ø–∞—Å 82%
- ‚úÖ –ú–∞–∫—Å 56 —Ç–æ–≤–∞—Ä–æ–≤

### –ü–æ—Å–ª–µ –§–∞–∑—ã 2 (—Å—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):
- ‚úÖ 10 read requests –∑–∞ 90 —Å–µ–∫—É–Ω–¥
- ‚úÖ 6.7 requests/minute
- ‚úÖ –ó–∞–ø–∞—Å 89%
- ‚úÖ –ú–∞–∫—Å 90 —Ç–æ–≤–∞—Ä–æ–≤

### –ü–æ—Å–ª–µ –§–∞–∑—ã 3 (–≥–ª—É–±–æ–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):
- ‚úÖ‚úÖ 8 read requests –∑–∞ 90 —Å–µ–∫—É–Ω–¥
- ‚úÖ‚úÖ 5.3 requests/minute
- ‚úÖ‚úÖ –ó–∞–ø–∞—Å 91%
- ‚úÖ‚úÖ –ú–∞–∫—Å 113 —Ç–æ–≤–∞—Ä–æ–≤

---

## üé¨ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:

1. ‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö –ù–ï–¢**
   - –í—Å–µ 11 —Ç–æ–≤–∞—Ä–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã
   - 282 –∑–∞–∫–∞–∑–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
   - –¢–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

2. ‚ö†Ô∏è **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è API –≤—ã–∑–æ–≤—ã –ï–°–¢–¨**
   - 49 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 8 (-84% potential)
   - –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch operations
   - –í—Ç–æ—Ä–∞—è –ø—Ä–∏—á–∏–Ω–∞: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ get_worksheet()

3. üéØ **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ —á—ë—Ç–∫–æ–µ**
   - –§–∞–∑–∞ 1 (1-2 —á–∞—Å–∞) ‚Üí -67% requests
   - –§–∞–∑–∞ 2 (3-4 —á–∞—Å–∞) ‚Üí -80% requests
   - –§–∞–∑–∞ 3 (8+ —á–∞—Å–æ–≤) ‚Üí -84% requests

4. üí™ **–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –∫—Ä–∏—Ç–∏—á–Ω–∞**
   - –¢–µ–∫—É—â–∏–µ 33 req/min < –ª–∏–º–∏—Ç 60 req/min
   - –ù–æ –∑–∞–ø–∞—Å –º–∞–ª–µ–Ω—å–∫–∏–π (45%)
   - –ü—Ä–∏ —Ä–æ—Å—Ç–µ —Ç–æ–≤–∞—Ä–æ–≤ (20+) –±—É–¥—É—Ç –ø—Ä–æ–±–ª–µ–º—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–í—ã–ø–æ–ª–Ω–∏—Ç—å –§–∞–∑—É 1 –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** (1-2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã):
- –£–±—Ä–∞—Ç—å verify_worksheet_structure()
- –î–æ–±–∞–≤–∏—Ç—å skip_existence_check
- –°—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å -67% –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–∑—ã 2 –∏ 3 - –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.**

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–î–∞—Ç–∞**: 28 –æ–∫—Ç—è–±—Ä—è 2025, 16:15  
**–í–µ—Ä—Å–∏—è**: 1.0 FINAL
