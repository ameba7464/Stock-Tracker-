# –û–¢–ß–Å–¢: –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ

**–î–∞—Ç–∞**: 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ **105, 77, 37 –∑–∞–∫–∞–∑–æ–≤** –≤–º–µ—Å—Ç–æ **97, 68, 23** (WB ground truth)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–®–ï–ù–û**

---

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –°–∏–º–ø—Ç–æ–º—ã
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª:

| –¢–æ–≤–∞—Ä | WB Ground Truth | –¢–∞–±–ª–∏—Ü–∞ (–î–û fix) | –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ |
|-------|-----------------|------------------|-------------|
| Its1_2_3/50g | 97 –∑–∞–∫–∞–∑–æ–≤ | 105 –∑–∞–∫–∞–∑–æ–≤ | **+8%** ‚ùå |
| Its2/50g | 68 –∑–∞–∫–∞–∑–æ–≤ | 77 –∑–∞–∫–∞–∑–æ–≤ | **+13%** ‚ùå |
| ItsSport2/50g | 23 –∑–∞–∫–∞–∑–æ–≤ | 37 –∑–∞–∫–∞–∑–æ–≤ | **+61%** ‚ùå |

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ **–ë–û–õ–¨–®–ï** –∑–∞–∫–∞–∑–æ–≤ —á–µ–º WB API!  
–≠—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏ —É–∫–∞–∑—ã–≤–∞–ª–æ –Ω–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ/–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

---

## üî¨ –ê–ù–ê–õ–ò–ó –ö–û–†–ù–ï–í–û–ô –ü–†–ò–ß–ò–ù–´

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –¥–ª—è –∑–∞–∫–∞–∑–æ–≤

–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ **–î–í–ê –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**:

#### ‚ùå –ü—É—Ç—å 1: `operations.refresh_table_data()` (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)
```python
# operations.py —Å—Ç—Ä–æ–∫–∞ 1313
def refresh_table_data():
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Analytics API v2 –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
    all_stock_data = wb_client.get_all_product_stock_data()  # Analytics v2
    
    # calculator.py —Å—Ç—Ä–æ–∫–∞ 1066
    orders_count = v2_metrics.get("ordersCount", 0)  # ‚ùå –ê–ì–†–ï–ì–ò–†–û–í–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï!
```

**–ü—Ä–æ–±–ª–µ–º—ã Analytics API v2**:
- ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ** –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
- ‚ùå **–ù–ï** —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (isCancel)
- ‚ùå **–ù–ï–¢** –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–Ω–µ—Ç srid –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
- ‚ùå **–ù–ï–õ–¨–ó–Ø** —Ç–æ—á–Ω–æ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–∏–æ–¥
- ‚ùå –î–∞–Ω–Ω—ã–µ **–Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### ‚úÖ –ü—É—Ç—å 2: `ProductService.sync_from_api_to_sheets()` (–ü–†–ê–í–ò–õ–¨–ù–û)
```python
# product_service.py —Å—Ç—Ä–æ–∫–∞ 249
async def sync_from_api_to_sheets():
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Orders API v1 –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    orders_data_raw = await data_fetcher.fetch_supplier_orders(date_from, flag=0)
    
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö
    valid_orders = [order for order in orders_data_raw if not order.get('isCancel')]
    
    # –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ srid
    unique_orders = {order['srid']: order for order in valid_orders}.values()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Orders API v1**:
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω—ã–µ** –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É
- ‚úÖ –ï—Å—Ç—å —Ñ–ª–∞–≥ `isCancel` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ï—Å—Ç—å `srid` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- ‚úÖ –¢–æ—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —á–µ—Ä–µ–∑ `dateFrom`
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–ª–∞–¥–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–∫–ª–∞–¥–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ #2: update_table.py –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å

```python
# update_table.py (–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø)
result = operations.update_table_on_startup()  # ‚ùå –í—ã–∑—ã–≤–∞–µ—Ç refresh_table_data()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
- –ú—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ ProductService (9 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤)
- –ù–û update_table.py –ø—Ä–æ–¥–æ–ª–∂–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å buggy –∫–æ–¥ operations.refresh_table_data()
- –¢–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏** –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Analytics API v2

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```python
# product_service.py (–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø)
def get_week_start():
    today = datetime.now()
    start_of_week = today - timedelta(days=today.weekday())  # ‚ùå –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
    return start_of_week.strftime("%Y-%m-%dT00:00:00")
```

**–ü—Ä–æ–±–ª–µ–º–∞**:
- 28 –æ–∫—Ç—è–±—Ä—è = –≤—Ç–æ—Ä–Ω–∏–∫
- –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ = 27 –æ–∫—Ç—è–±—Ä—è (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
- –ü–µ—Ä–∏–æ–¥ = **–¢–û–õ–¨–ö–û 1 –î–ï–ù–¨** –≤–º–µ—Å—Ç–æ 7 –¥–Ω–µ–π!

**WB ground truth**: 22-28 –æ–∫—Ç—è–±—Ä—è = **7 –î–ù–ï–ô**  
**–ù–∞—à –ø–µ—Ä–∏–æ–¥**: 27-28 –æ–∫—Ç—è–±—Ä—è = **1 –î–ï–ù–¨**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –û–∂–∏–¥–∞–ª–æ—Å—å: ~188 –∑–∞–∫–∞–∑–æ–≤ (7 –¥–Ω–µ–π)
- –ü–æ–ª—É—á–µ–Ω–æ: ~27 –∑–∞–∫–∞–∑–æ–≤ (1 –¥–µ–Ω—å)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏: 41 –∑–∞–∫–∞–∑ (–æ—à–∏–±–∫–∞ +52%)

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–í–∞—Ä–∏–∞–Ω—Ç A)

**–î–û**:
```python
# update_table.py
result = operations.update_table_on_startup()  # ‚ùå Analytics v2
```

**–ü–û–°–õ–ï**:
```python
# update_table_fixed.py
async def update_table_data_async():
    product_service = ProductService(config)
    operations.clear_all_products(spreadsheet_id, worksheet_name)
    sync_session = await product_service.sync_from_api_to_sheets()  # ‚úÖ Orders v1
```

**–ü–æ—á–µ–º—É –í–∞—Ä–∏–∞–Ω—Ç A (—É–¥–∞–ª–µ–Ω–∏–µ refresh_table_data)**:
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ ProductService
- ‚úÖ –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–¥–∏–Ω –∫–æ–¥ –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- ‚úÖ ProductService —É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω (62‚Üí58 –∑–∞–∫–∞–∑–æ–≤, 100% —É—Å–ø–µ—Ö)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –í–∞—Ä–∏–∞–Ω—Ç B** (–æ—Ç–∫–ª–æ–Ω—ë–Ω):
- –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å refresh_table_data() —Å Orders API v1
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –∏–∑ ProductService
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–æ–¥–∞ ‚ùå

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–î–û**:
```python
def get_week_start():
    today = datetime.now()
    start_of_week = today - timedelta(days=today.weekday())  # ‚ùå 1 –¥–µ–Ω—å
    return start_of_week.strftime("%Y-%m-%dT00:00:00")
```

**–ü–û–°–õ–ï**:
```python
def get_week_start():
    today = datetime.now()
    week_ago = today - timedelta(days=ORDER_LOOKBACK_DAYS)  # ‚úÖ 7 –¥–Ω–µ–π (–ø–æ–ª–Ω–∞—è –Ω–µ–¥–µ–ª—è)
    return week_ago.strftime("%Y-%m-%dT00:00:00")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –¢–µ–ø–µ—Ä—å –±–µ—Ä—ë–º –¥–∞–Ω–Ω—ã–µ –∑–∞ **–ø–æ–ª–Ω—ã–µ 7 –¥–Ω–µ–π**
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç WB ground truth –ø–µ—Ä–∏–æ–¥—É
- –û–∂–∏–¥–∞–µ–º ~188 –∑–∞–∫–∞–∑–æ–≤ –≤–º–µ—Å—Ç–æ ~27

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø–µ—Ä–∏–æ–¥ 1 –¥–µ–Ω—å)

```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò –ó–ê–ö–ê–ó–û–í:
   Total raw orders from API:      62
   After filtering cancelled:      58 (-4)
   After deduplication (srid):     58 (-0)
   Final orders_data count:        58
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ**:
- Its1_2_3/50g: 18 –∑–∞–∫–∞–∑–æ–≤ (–±—ã–ª–æ 105) ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!
- Its2/50g: 17 –∑–∞–∫–∞–∑–æ–≤ (–±—ã–ª–æ 77) ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!
- ItsSport2/50g: 6 –∑–∞–∫–∞–∑–æ–≤ (–±—ã–ª–æ 37) ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–æ–ª—å–∫–æ 41 –∑–∞–∫–∞–∑ –≤–º–µ—Å—Ç–æ ~188 (–ø–µ—Ä–∏–æ–¥ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π)

### –≠—Ç–∞–ø 2: –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ (–ø–µ—Ä–∏–æ–¥ 7 –¥–Ω–µ–π) - –í –ü–†–û–¶–ï–°–°–ï

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- Its1_2_3/50g: ~97 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- Its2/50g: ~68 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- ItsSport2/50g: ~23 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- **–ò–¢–û–ì–û**: ~188 –∑–∞–∫–∞–∑–æ–≤

---

## üéØ –ü–†–ò–ú–ï–ù–Å–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –ó–∞–º–µ–Ω–∞ Analytics API v2 ‚Üí Orders API v1
- **–ë—ã–ª–æ**: `v2_metrics.get("ordersCount")` - –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–°—Ç–∞–ª–æ**: `fetch_supplier_orders(date_from)` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 2. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- **–ë—ã–ª–æ**: –í—Å–µ –∑–∞–∫–∞–∑—ã –≤–∫–ª—é—á–∞—è isCancel=True
- **–°—Ç–∞–ª–æ**: –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (isCancel=False)
- **–≠—Ñ—Ñ–µ–∫—Ç**: -4 –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ (62‚Üí58)

### 3. ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ srid
- **–ë—ã–ª–æ**: –î—É–±–ª–∏–∫–∞—Ç—ã —Å—á–∏—Ç–∞–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
- **–°—Ç–∞–ª–æ**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ srid
- **–≠—Ñ—Ñ–µ–∫—Ç**: 0 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫), –∑–∞—â–∏—Ç–∞ –Ω–∞ –±—É–¥—É—â–µ–µ

### 4. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–ª–∞–¥–æ–≤
- **–ë—ã–ª–æ**: "–û–±—É—Ö–æ–≤–æ   –ú–ü" (–ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã)
- **–°—Ç–∞–ª–æ**: "–û–±—É—Ö–æ–≤–æ –ú–ü" (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤

### 5. ‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (7 –¥–Ω–µ–π)
- **–ë—ã–ª–æ**: –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (1 –¥–µ–Ω—å)
- **–°—Ç–∞–ª–æ**: 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–ø–æ–ª–Ω–∞—è –Ω–µ–¥–µ–ª—è)
- **–≠—Ñ—Ñ–µ–∫—Ç**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ WB ground truth

### 6. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞
- **–ë—ã–ª–æ**: –î–≤–∞ –ø—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (ProductService + refresh_table_data)
- **–°—Ç–∞–ª–æ**: –û–¥–∏–Ω –ø—É—Ç—å (—Ç–æ–ª—å–∫–æ ProductService)
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 7. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–∫–ª–∞–¥–∞–º
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
- –û—à–∏–±–∫–∏ API

### 8. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–ª–∞–¥–æ–≤ —Å –Ω—É–ª–µ–≤—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º
- **–ë—ã–ª–æ**: –°–∫–ª–∞–¥—ã —Å –∑–∞–∫–∞–∑–∞–º–∏ –Ω–æ –±–µ–∑ –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å
- **–°—Ç–∞–ª–æ**: –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–≠—Ñ—Ñ–µ–∫—Ç**: –í—Å–µ —Å–∫–ª–∞–¥—ã –≤–∏–¥–∏–º—ã

### 9. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–∫–ª–∞–¥–æ–≤
- **–ë—ã–ª–æ**: "–û–±—É—Ö–æ–≤–æ –ú–ü" –º–æ–≥ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è
- **–°—Ç–∞–ª–æ**: FBS/–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–∫–ª–∞–¥—ã –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—é—Ç—Å—è
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

---

## üìù –§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–´

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **update_table_fixed.py** (–ù–û–í–´–ô)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ProductService –≤–º–µ—Å—Ç–æ operations
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

2. **src/stock_tracker/services/product_service.py**
   - `get_week_start()`: 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –≤–º–µ—Å—Ç–æ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–æ

3. **check_table_after_fix.py** (–ù–û–í–´–ô)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å WB ground truth
   - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

4. **check_period.py** (–ù–û–í–´–ô)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

5. **FIX_REFRESH_TABLE_DATA.py** (–ù–û–í–´–ô)
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
   - –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

## üöÄ –î–ê–õ–¨–ù–ï–ô–®–ò–ï –®–ê–ì–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. ‚è≥ –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (—Å –ø–µ—Ä–∏–æ–¥–æ–º 7 –¥–Ω–µ–π)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ check_table_after_fix.py
3. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å WB ‚â§ 10%

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. ‚ùå **–£–î–ê–õ–ò–¢–¨** `operations.refresh_table_data()` - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥
2. ‚úÖ **–û–ë–ù–û–í–ò–¢–¨** –≤—Å–µ –≤—ã–∑–æ–≤—ã ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ProductService
3. ‚úÖ **–î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨** –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. ‚úÖ **–î–û–ë–ê–í–ò–¢–¨** –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–∏–æ–¥–∞
5. ‚úÖ **–ù–ê–°–¢–†–û–ò–¢–¨** –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π —Å WB

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:
- [ ] –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ~188 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- [ ] Its1_2_3/50g: ~97 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- [ ] Its2/50g: ~68 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- [ ] ItsSport2/50g: ~23 –∑–∞–∫–∞–∑–æ–≤ (¬±10%)
- [ ] –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (srid —É–Ω–∏–∫–∞–ª—å–Ω—ã)
- [ ] –ù–µ—Ç –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (isCancel –ø—Ä–æ–≤–µ—Ä–µ–Ω)
- [ ] –í—Å–µ —Å–∫–ª–∞–¥—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] FBS/–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–∫–ª–∞–¥—ã –≤–∫–ª—é—á–µ–Ω—ã

---

## üí° –í–´–í–û–î–´

### –ß—Ç–æ —É–∑–Ω–∞–ª–∏:

1. **–î–≤–∞ API ‚â† –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - Analytics API v2: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - Orders API v1: –¥–µ—Ç–∞–ª—å–Ω—ã–µ, —Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - **–î–ª—è –∑–∞–∫–∞–∑–æ–≤ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Orders API v1**

2. **–ü–µ—Ä–∏–æ–¥ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ**
   - "–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—á–µ—Ä–∞ (1 –¥–µ–Ω—å)
   - "7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥" –≤—Å–µ–≥–¥–∞ –ø–æ–ª–Ω–∞—è –Ω–µ–¥–µ–ª—è
   - **–î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å WB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–Ω–∏ –Ω–∞–∑–∞–¥**

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ = –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–≥–æ–≤**
   - ProductService –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, refresh_table_data() - –Ω–µ—Ç
   - –î–≤–∞ –ø—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ = –¥–≤–æ–π–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - **–û–¥–∏–Ω –ø—É—Ç—å, –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**

4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω–∞**
   - isCancel=True –º–æ–∂–µ—Ç –¥–∞—Ç—å +6% –ª–∏—à–Ω–∏—Ö –∑–∞–∫–∞–∑–æ–≤
   - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ srid –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ
   - **–í—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å**

### –£—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–º–æ–≥–ª–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –±—ã—Å—Ç—Ä–æ  
‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å ground truth** - –≤—ã—è–≤–∏–ª–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —Å—Ä–∞–∑—É  
‚úÖ **–ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–ª–∏ –∫–∞–∂–¥—É—é –ø—Ä–æ–±–ª–µ–º—É  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫** - check_table_after_fix.py  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç –¥–ª—è –±—É–¥—É—â–µ–≥–æ

---

## üìå –°–¢–ê–¢–£–°: ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Analytics API v2 –≤–º–µ—Å—Ç–æ Orders API v1  
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ProductService —Å Orders API v1 + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–∂–∏–¥–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ WB ground truth ¬±10%  
**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –í –ø—Ä–æ—Ü–µ—Å—Å–µ (–≤—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–î–∞—Ç–∞**: 28 –æ–∫—Ç—è–±—Ä—è 2025, 16:10  
**–í–µ—Ä—Å–∏—è**: 1.0 (DRAFT - –æ–∂–∏–¥–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
