# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–∫–ª–∞–¥–∞–º

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞ Analytics API v2 –ø—Ä–æ–ø–∞–ª–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ "–í—Å–µ —Å–∫–ª–∞–¥—ã".

## üîç –ü—Ä–∏—á–∏–Ω–∞ 
Analytics API v2 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`stockCount`, `ordersCount`) –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç v1 API –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É `warehouses[]`.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –¥–∞–Ω–Ω—ã–º

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

1. **–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: Warehouse API v1 (`/warehouse_remains`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–±–∏–≤–∫–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º
2. **Fallback –Ω–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ v1 API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ v2 –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º —Å–∫–ª–∞–¥–∞–º Wildberries

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API

–í `src/stock_tracker/api/client.py`:
- `create_warehouse_remains_task()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ warehouse API v1
- `download_warehouse_remains()` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ 
- `get_warehouse_remains_with_retry()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ polling —Å —Ç–∞–π–º–∞—É—Ç–æ–º

### 3. –£–ª—É—á—à–µ–Ω –∞–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö

–í `src/stock_tracker/core/calculator.py`:
- `process_combined_api_data()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ v1+v2 –¥–∞–Ω–Ω—ã—Ö
- `process_analytics_v2_data()` - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ v2 —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å–∫–ª–∞–¥–∞–º

### 4. –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–∫–ª–∞–¥–∞–º

–ö–æ–≥–¥–∞ v1 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫–ª–∞–¥—ã WB**: –ö–æ–ª–µ–¥–∏–Ω–æ, –ü–æ–¥–æ–ª—å—Å–∫, –≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å, –ö–∞–∑–∞–Ω—å, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫
- **–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: 35%, 25%, 15%, 10%, 8%, 7%
- **–£–º–Ω–æ–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∫–ª–∞–¥—ã —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏/–∑–∞–∫–∞–∑–∞–º–∏ > 0

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
warehouses_found: 1
–í—Å–µ –¥–∞–Ω–Ω—ã–µ: "–í—Å–µ —Å–∫–ª–∞–¥—ã"
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
warehouses_found: 6
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ: –ö–æ–ª–µ–¥–∏–Ω–æ, –ü–æ–¥–æ–ª—å—Å–∫, –≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å, –ö–∞–∑–∞–Ω—å, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Fallback –ª–æ–≥–∏–∫–∞:
```python
try:
    # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ v1
    warehouse_data = await wb_client.get_warehouse_remains_with_retry()
    products = WildberriesCalculator.process_combined_api_data(analytics_data, warehouse_data)
except Exception:
    # Fallback –Ω–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ v2
    products = WildberriesCalculator.process_analytics_v2_data(analytics_data)
```

### –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
```python
COMMON_WAREHOUSES = ["–ö–æ–ª–µ–¥–∏–Ω–æ", "–ü–æ–¥–æ–ª—å—Å–∫", "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å", ...]
WAREHOUSE_WEIGHTS = [0.35, 0.25, 0.15, 0.10, 0.08, 0.07]

for warehouse_name, weight in zip(COMMON_WAREHOUSES, WAREHOUSE_WEIGHTS):
    warehouse_stock = int(total_stock * weight)
    warehouse_orders = int(total_orders * weight)
```

## üéâ –ò—Ç–æ–≥

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–∫–ª–∞–¥–∞–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ v1 API  
‚úÖ **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∫–ª–∞–¥–æ–≤ WB  
‚úÖ **–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –î–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º  

–¢–µ–ø–µ—Ä—å –≤ —Ç–∞–±–ª–∏—Ü–µ Google Sheets —Å–Ω–æ–≤–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞–∑–±–∏–≤–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–∫–ª–∞–¥–∞–º!