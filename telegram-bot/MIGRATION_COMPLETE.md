# üéâ –ú–∏–≥—Ä–∞—Ü–∏—è Telegram –ë–æ—Ç–∞ –ó–∞–≤–µ—Ä—à–µ–Ω–∞!

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Ñ–∞–π–ª—ã –∏–∑ `telegram-bot/` (–∫—Ä–æ–º–µ `.env` –∏ `.gitignore`)

### 2. –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è StockTr-bot

```
telegram-bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (pydantic)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ states.py           # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py        # /start –∏ /help
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registration.py # –í–æ—Ä–æ–Ω–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ menu.py         # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reply.py        # ReplyKeyboard (—Ç–µ–ª–µ—Ñ–æ–Ω)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inline.py       # InlineKeyboard (–º–µ–Ω—é)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ db.py           # Database middleware
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ payment.py      # Payment middleware (–∑–∞–≥–ª—É—à–∫–∞)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py           # SQLAlchemy –º–æ–¥–µ–ª–∏ (User)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crud.py             # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.py       # –í–∞–ª–∏–¥–∞—Ü–∏—è email, phone, name
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ logger.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ logs/                       # –õ–æ–≥–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ .env                        # –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .gitignore                  # Git ignore
‚îú‚îÄ‚îÄ Dockerfile                  # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
aiogram==3.13.1              # Telegram Bot Framework
sqlalchemy==2.0.35           # ORM
aiosqlite==0.20.0            # Async SQLite driver
greenlet==3.1.1              # Async support
alembic==1.13.3              # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
python-dotenv==1.0.1         # .env —Ñ–∞–π–ª—ã
pydantic==2.9.2              # –í–∞–ª–∏–¥–∞—Ü–∏—è
pydantic-settings==2.6.0     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
aiofiles==24.1.0             # Async —Ñ–∞–π–ª—ã
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –í–æ—Ä–æ–Ω–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (FSM)
1. **GET_NAME** - —Å–±–æ—Ä –∏–º–µ–Ω–∏ (2-50 —Å–∏–º–≤–æ–ª–æ–≤)
2. **GET_EMAIL** - —Å–±–æ—Ä email (–≤–∞–ª–∏–¥–∞—Ü–∏—è regex)
3. **GET_PHONE** - —Å–±–æ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–Ω–æ–ø–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç, 10-15 —Ü–∏—Ñ—Ä)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–ú–æ–¥–µ–ª—å User:**
- `telegram_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- `name` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `email` - email
- `phone` - —Ç–µ–ª–µ—Ñ–æ–Ω
- `payment_status` - —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (pending/completed/failed)
- `google_sheet_sent` - —Ñ–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
- `created_at` / `updated_at` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/start` - –Ω–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ / –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/help` - —Å–ø—Ä–∞–≤–∫–∞

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)
- üìä –ü–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–Ω–æ–≤–∞
- ‚ÑπÔ∏è –û –±–æ—Ç–µ
- ‚ùì –ü–æ–º–æ—â—å

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
```env
BOT_TOKEN=your_bot_token_here
DB_HOST=localhost
DB_NAME=tgstock
GOOGLE_SHEET_URL=https://docs.google.com/spreadsheets/d/...
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
cd telegram-bot
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```bash
python -m app.main
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª `tgstock` –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

### PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
1. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ `app/config.py` —Å—Ç—Ä–æ–∫—É 36:
```python
return f"postgresql+asyncpg://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_name}"
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ asyncpg:
```bash
pip install asyncpg
```

3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É:
```sql
CREATE DATABASE tgstock;
```

## üí° –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

### –í `app/bot/handlers/registration.py`
```python
# –°—Ç—Ä–æ–∫–∞ ~139
# [–¢–û–ß–ö–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ü–õ–ê–¢–ï–ñ–ï–ô]
# if settings.payment_enabled:
#     await send_payment_invoice(message, user)
#     await state.set_state(RegistrationStates.PAYMENT_PENDING)
#     return
```

### –í `app/bot/middlewares/payment.py`
```python
# –°—Ç—Ä–æ–∫–∞ ~30
# [–¢–û–ß–ö–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ü–õ–ê–¢–ï–ñ–ï–ô]
# if settings.payment_enabled:
#     if not await check_payment_status(user_id):
#         await event.answer("–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞")
#         return
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `logs/bot.log` - —Ñ–∞–π–ª–æ–≤—ã–π –ª–æ–≥
- –ö–æ–Ω—Å–æ–ª—å - –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `.env`:
```env
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
```

## üê≥ Docker

–°–æ–∑–¥–∞–Ω `Dockerfile` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏:

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t tgstock-bot .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker run -d --env-file .env tgstock-bot
```

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (–∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è) |
|--------|---------------|-------------------------------|
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** | –ü–ª–æ—Å–∫–∞—è (–≤—Å–µ –≤ –∫–æ—Ä–Ω–µ) | –ú–æ–¥—É–ª—å–Ω–∞—è (app/) |
| **Handlers** | –í –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ | –†–∞–∑–¥–µ–ª–µ–Ω—ã (start, registration, menu) |
| **Middlewares** | –ù–µ—Ç | Database + Payment |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è | –û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ë–∞–∑–æ–≤–æ–µ | –§–∞–π–ª + –∫–æ–Ω—Å–æ–ª—å |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–ª–∞—Ç–µ–∂–∞–º** | –ù–µ—Ç | –î–∞ (—Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏) |

## üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
2. `LOG_LEVEL=DEBUG` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Ä–æ–Ω–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –î–ª—è production:
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ PostgreSQL
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker
3. `LOG_LEVEL=INFO` –∏–ª–∏ `WARNING`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º

–≠—Ç–æ—Ç –±–æ—Ç –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º Stock-Tracker –ø—Ä–æ–µ–∫—Ç–æ–º:

1. **–û–±—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—É –∂–µ PostgreSQL
2. **API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** - –≤—ã–∑—ã–≤–∞–π—Ç–µ Stock-Tracker API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ï–¥–∏–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ telegram_id —Å —Ç–∞–±–ª–∏—Ü–µ–π tenants

### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ `registration.py`:
```python
import httpx

async with httpx.AsyncClient() as client:
    response = await client.post(
        "http://localhost:8000/api/v1/auth/register",
        json={
            "email": email,
            "telegram_id": telegram_id,
            "name": name,
            "phone": phone
        }
    )
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ app/ —Å–æ–∑–¥–∞–Ω–∞
- [x] –í—Å–µ handlers –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [x] Keyboards —Å–æ–∑–¥–∞–Ω—ã
- [x] Middlewares –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [x] Database models –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [x] requirements.txt –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] .env.example —Å–æ–∑–¥–∞–Ω
- [x] Dockerfile –≥–æ—Ç–æ–≤
- [x] README.md –Ω–∞–ø–∏—Å–∞–Ω

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í–∞—à –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è StockTr-bot –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É. –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π.

---

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:** 25 –Ω–æ—è–±—Ä—è 2025 –≥.  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://github.com/ameba7464/StockTr-bot
