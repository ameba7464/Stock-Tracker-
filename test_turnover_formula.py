"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º—É–ª—ã –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º.
"""

import os
import sys

# Change to script directory
script_dir = os.path.dirname(os.path.abspath(__file__))
os.chdir(script_dir)
sys.path.insert(0, os.path.join(script_dir, 'src'))

from stock_tracker.core.models import Warehouse

def test_turnover_calculation():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏"""
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º")
    print("=" * 60)
    print()
    
    # –¢–µ—Å—Ç 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π
    print("üìä –¢–µ—Å—Ç 1: –°–∫–ª–∞–¥ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –∏ –∑–∞–∫–∞–∑–∞–º–∏")
    wh1 = Warehouse(name="–°–¶ –í–æ–ª–≥–æ–≥—Ä–∞–¥", stock=654, orders=32)
    print(f"   –û—Å—Ç–∞—Ç–æ–∫: {wh1.stock} —à—Ç")
    print(f"   –ó–∞–∫–∞–∑–æ–≤: {wh1.orders} —à—Ç (–∑–∞ –Ω–µ–¥–µ–ª—é)")
    print(f"   –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: {wh1.turnover} –¥–Ω–µ–π")
    print(f"   –†–∞—Å—á—ë—Ç: {wh1.stock} // {wh1.orders} = {wh1.stock // wh1.orders}")
    
    expected_turnover = 654 // 32  # = 20 –¥–Ω–µ–π
    assert wh1.turnover == expected_turnover, f"–û–∂–∏–¥–∞–ª–æ—Å—å {expected_turnover}, –ø–æ–ª—É—á–µ–Ω–æ {wh1.turnover}"
    print(f"   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å—Å—è {wh1.turnover} –¥–Ω–µ–π")
    print()
    
    # –¢–µ—Å—Ç 2: –ú–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤, –º–∞–ª–æ –æ—Å—Ç–∞—Ç–∫–æ–≤
    print("üìä –¢–µ—Å—Ç 2: –°–∫–ª–∞–¥ —Å –º–∞–ª—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º –∏ –±–æ–ª—å—à–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏")
    wh2 = Warehouse(name="–ö–∞–∑–∞–Ω—å", stock=68, orders=1)
    print(f"   –û—Å—Ç–∞—Ç–æ–∫: {wh2.stock} —à—Ç")
    print(f"   –ó–∞–∫–∞–∑–æ–≤: {wh2.orders} —à—Ç (–∑–∞ –Ω–µ–¥–µ–ª—é)")
    print(f"   –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: {wh2.turnover} –¥–Ω–µ–π")
    
    expected_turnover2 = 68 // 1  # = 68 –¥–Ω–µ–π
    assert wh2.turnover == expected_turnover2, f"–û–∂–∏–¥–∞–ª–æ—Å—å {expected_turnover2}, –ø–æ–ª—É—á–µ–Ω–æ {wh2.turnover}"
    print(f"   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å—Å—è {wh2.turnover} –¥–Ω–µ–π")
    print()
    
    # –¢–µ—Å—Ç 3: –û—Å—Ç–∞—Ç–∫–∏ –µ—Å—Ç—å, –∑–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç
    print("üìä –¢–µ—Å—Ç 3: –°–∫–ª–∞–¥ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏, –Ω–æ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤")
    wh3 = Warehouse(name="–û–±—É—Ö–æ–≤–æ", stock=100, orders=0)
    print(f"   –û—Å—Ç–∞—Ç–æ–∫: {wh3.stock} —à—Ç")
    print(f"   –ó–∞–∫–∞–∑–æ–≤: {wh3.orders} —à—Ç")
    print(f"   –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: {wh3.turnover} –¥–Ω–µ–π")
    
    assert wh3.turnover == 0, f"–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 0"
    print(f"   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ ‚Üí –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å = 0")
    print()
    
    # –¢–µ—Å—Ç 4: –ó–∞–∫–∞–∑—ã –µ—Å—Ç—å, –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–µ—Ç
    print("üìä –¢–µ—Å—Ç 4: –°–∫–ª–∞–¥ —Å –∑–∞–∫–∞–∑–∞–º–∏, –Ω–æ –±–µ–∑ –æ—Å—Ç–∞—Ç–∫–æ–≤")
    wh4 = Warehouse(name="–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å", stock=0, orders=282)
    print(f"   –û—Å—Ç–∞—Ç–æ–∫: {wh4.stock} —à—Ç")
    print(f"   –ó–∞–∫–∞–∑–æ–≤: {wh4.orders} —à—Ç")
    print(f"   –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: {wh4.turnover} –¥–Ω–µ–π")
    
    expected_turnover4 = 0 // 282  # = 0 –¥–Ω–µ–π (–Ω–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤)
    assert wh4.turnover == expected_turnover4, f"–û–∂–∏–¥–∞–ª–æ—Å—å {expected_turnover4}, –ø–æ–ª—É—á–µ–Ω–æ {wh4.turnover}"
    print(f"   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ù–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ ‚Üí –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å = 0")
    print()
    
    # –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    print("üìä –¢–µ—Å—Ç 5: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–∫–ª–∞–¥–∞")
    wh5 = Warehouse(name="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ - –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π 12", stock=87, orders=14)
    print(f"   –û—Å—Ç–∞—Ç–æ–∫: {wh5.stock} —à—Ç")
    print(f"   –ó–∞–∫–∞–∑–æ–≤: {wh5.orders} —à—Ç")
    print(f"   –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: {wh5.turnover} –¥–Ω–µ–π")
    
    expected_turnover5 = 87 // 14  # = 6 –¥–Ω–µ–π
    assert wh5.turnover == expected_turnover5, f"–û–∂–∏–¥–∞–ª–æ—Å—å {expected_turnover5}, –ø–æ–ª—É—á–µ–Ω–æ {wh5.turnover}"
    print(f"   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏")
    print()
    
    print("=" * 60)
    print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!")
    print()
    print("üìù –§–æ—Ä–º—É–ª–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏: stock // orders")
    print("   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ç–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å—Å—è")
    print("   –ø—Ä–∏ —Ç–µ–∫—É—â–∏—Ö —Ç–µ–º–ø–∞—Ö –∑–∞–∫–∞–∑–æ–≤")
    print()
    print("üí° –ü—Ä–∏–º–µ—Ä—ã:")
    print("   - 654 —à—Ç –æ—Å—Ç–∞—Ç–æ–∫, 32 –∑–∞–∫–∞–∑–∞ ‚Üí 654//32 = 20 –¥–Ω–µ–π")
    print("   - 68 —à—Ç –æ—Å—Ç–∞—Ç–æ–∫, 1 –∑–∞–∫–∞–∑ ‚Üí 68//1 = 68 –¥–Ω–µ–π")
    print("   - 87 —à—Ç –æ—Å—Ç–∞—Ç–æ–∫, 14 –∑–∞–∫–∞–∑–æ–≤ ‚Üí 87//14 = 6 –¥–Ω–µ–π ‚ö†Ô∏è  (–º–∞–ª–æ!)")

if __name__ == "__main__":
    try:
        test_turnover_calculation()
    except AssertionError as e:
        print(f"\n‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: {e}")
        sys.exit(1)
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)
