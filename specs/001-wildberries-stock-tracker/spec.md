# Feature Specification: Wildberries Stock Tracker

**Feature Branch**: `001-wildberries-stock-tracker`  
**Created**: 21 октября 2025 г.  
**Status**: Draft  
**Input**: User description: "Google-таблица для учета остатков и заказов товаров Wildberries"

## Clarifications

### Session 2025-10-21

- Q: API Integration Reference → A: Данные о складах и остатках будут получаться через Wildberries API. Для каждого nmId необходимо получить список всех складов (warehouseName) где он встречается, и узнать остаток (quantity) этого артикула на каждом складе. Подробности реализации см. urls.md
- Q: Частота обновления данных → A: раз в день в 00:00

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Create Product Inventory Record (Priority: P1)

Продавец может создать запись о товаре с основными данными: артикул продавца, артикул Wildberries, общие заказы и остатки, что позволяет начать базовый учет товаров.

**Why this priority**: Основная функциональность для начала работы с системой учета - без возможности создать запись о товаре остальной функционал невозможен.

**Independent Test**: Можно полностью протестировать созданием одной записи товара и проверкой корректности сохранения всех основных полей.

**Acceptance Scenarios**:

1. **Given** пустая Google-таблица с заголовками, **When** продавец вводит артикул продавца, артикул товара, общие заказы и остатки, **Then** данные сохраняются в соответствующих колонках A-D
2. **Given** введенные основные данные товара, **When** система рассчитывает оборачиваемость, **Then** в колонке E отображается корректный результат деления заказов на остатки

---

### User Story 2 - Manage Multi-Warehouse Data (Priority: P2)

Продавец может добавить данные по нескольким складам для одного товара, указав название склада, заказы и остатки по каждому складу в структурированном виде.

**Why this priority**: Ключевая функция для работы с несколькими складами - основное отличие от простых таблиц учета.

**Independent Test**: Можно протестировать добавлением данных по 2-3 складам для одного товара и проверкой синхронизации порядка данных в колонках F, G, H.

**Acceptance Scenarios**:

1. **Given** созданная запись товара, **When** продавец добавляет данные по нескольким складам через перевод строки (ALT+ENTER), **Then** данные корректно отображаются в колонках F, G, H с сохранением порядка
2. **Given** данные по складам, **When** продавец изменяет порядок складов, **Then** соответствующие заказы и остатки автоматически переупорядочиваются

---

### User Story 3 - Automatic Calculations and Aggregation (Priority: P3)

Система автоматически рассчитывает общие показатели (суммы заказов и остатков по всем складам) и обновляет оборачиваемость при изменении данных по отдельным складам.

**Why this priority**: Автоматизация расчетов повышает точность и удобство, но базовый функционал может работать и с ручным вводом сумм.

**Independent Test**: Можно протестировать изменением данных по отдельным складам и проверкой автоматического пересчета общих показателей.

**Acceptance Scenarios**:

1. **Given** данные по нескольким складам, **When** система рассчитывает общие показатели, **Then** колонки C и D содержат корректные суммы по всем складам
2. **Given** изменение данных по одному складу, **When** происходит пересчет, **Then** общие показатели и оборачиваемость обновляются автоматически

---

### Edge Cases

- Что происходит при вводе нулевых остатков (деление на ноль в расчете оборачиваемости)?
- Как система обрабатывает несоответствие количества строк в колонках F, G, H?
- Что происходит при вводе отрицательных значений заказов или остатков?
- Как обрабатывается ввод дублирующихся артикулов продавца?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система ДОЛЖНА позволять ввод артикула продавца в колонку A
- **FR-002**: Система ДОЛЖНА позволять ввод артикула товара Wildberries в колонку B  
- **FR-003**: Система ДОЛЖНА рассчитывать общее количество заказов в колонке C
- **FR-004**: Система ДОЛЖНА рассчитывать общее количество остатков в колонке D
- **FR-005**: Система ДОЛЖНА автоматически рассчитывать оборачиваемость (заказы/остатки) в колонке E
- **FR-006**: Система ДОЛЖНА поддерживать ввод множественных названий складов через перевод строки в колонке F
- **FR-007**: Система ДОЛЖНА поддерживать ввод заказов по каждому складу через перевод строки в колонке G
- **FR-008**: Система ДОЛЖНА поддерживать ввод остатков по каждому складу через перевод строки в колонке H
- **FR-009**: Система ДОЛЖНА обеспечивать синхронизацию порядка данных в колонках F, G, H
- **FR-010**: Система ДОЛЖНА применять форматирование: жирные заголовки, перенос текста в колонках F-H, числовой формат для оборачиваемости
- **FR-011**: Система ДОЛЖНА валидировать уникальность артикулов продавца
- **FR-012**: Система ДОЛЖНА отображать значение 0 для оборачиваемости при нулевых остатках товара
- **FR-013**: Система ДОЛЖНА интегрироваться с Wildberries API для получения данных о складах и остатках по nmId (детали см. urls.md)
- **FR-014**: Система ДОЛЖНА автоматически обновлять данные из Wildberries API ежедневно в 00:00

### Key Entities

- **Товар**: Основная единица учета, содержит артикул продавца, артикул Wildberries, агрегированные данные по заказам и остаткам
- **Склад**: Точка хранения товаров, имеет название и связанные данные по заказам/остаткам для конкретного товара
- **Запись учета**: Строка таблицы, объединяющая данные одного товара по всем складам

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Продавцы могут создать запись о товаре за менее чем 2 минуты
- **SC-002**: Система корректно обрабатывает данные по 50+ товарам без снижения производительности
- **SC-003**: 95% расчетов оборачиваемости выполняются мгновенно при вводе данных
- **SC-004**: 100% данных по складам сохраняют корректный порядок при вводе через перевод строки
- **SC-005**: Система предотвращает 100% случаев дублирования артикулов продавца
- **SC-006**: Пользователи успешно работают с множественными складами в 90% случаев с первой попытки

