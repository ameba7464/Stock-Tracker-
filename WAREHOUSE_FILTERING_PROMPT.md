# üîß –ü–†–û–ú–ü–¢ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú –°–û –°–ö–õ–ê–î–ê–ú–ò

## üéØ –¶–ï–õ–¨
–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤, –≥–¥–µ —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∫–ª–∞–¥–æ–≤ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–∫–ª–∞–¥–æ–≤.

## üö® –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –≤–º–µ—Å—Ç–æ —Å–∫–ª–∞–¥–æ–≤
**–ß—Ç–æ —Å–µ–π—á–∞—Å –≤ —Ç–∞–±–ª–∏—Ü–µ**:
```
- "–í –ø—É—Ç–∏ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"
- "–í –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å–∫–ª–∞–¥ WB"  
- "–í—Å–µ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö"
```
**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**: –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–∫–ª–∞–¥—ã —Ç–∏–ø–∞ "–¢—É–ª–∞", "–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã", "–î–æ–º–æ–¥–µ–¥–æ–≤–æ"

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–º–µ—à–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
**–¢–µ–∫—É—â–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è**: "–ü–æ–¥–æ–ª—å—Å–∫ 3", "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–ß–µ—Ö–æ–≤ 1"
**–û–∂–∏–¥–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è**: –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∫–ª–∞–¥—ã –∏–∑ Warehouse API v1

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
–°–∏—Å—Ç–µ–º–∞ –Ω–µ –æ—Ç–ª–∏—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤

## ‚úÖ –¢–†–ï–ë–£–ï–ú–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
```python
# –í –º–µ—Ç–æ–¥ process_combined_api_data() –∏–ª–∏ group_data_by_product()
DELIVERY_STATUSES = {
    "–í –ø—É—Ç–∏ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π",
    "–í –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å–∫–ª–∞–¥ WB", 
    "–í—Å–µ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö",
    "–í –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –ü–í–ó",
    "–í –ø—É—Ç–∏ —Å –ü–í–ó –ø–æ–∫—É–ø–∞—Ç–µ–ª—é",
    "–£–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –≤–æ–∑–º–µ—â–µ–Ω–∏—è",
    "–ö –¥–æ–ø–ª–∞—Ç–µ",
    "–û–±—â–∏–π –∏—Ç–æ–≥"
}

def is_real_warehouse(warehouse_name: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π —Å–∫–ª–∞–¥, –∞ –Ω–µ —Å—Ç–∞—Ç—É—Å."""
    if not warehouse_name or not isinstance(warehouse_name, str):
        return False
    
    # –ò—Å–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
    if warehouse_name in DELIVERY_STATUSES:
        return False
        
    # –ò—Å–∫–ª—é—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏
    if any(word in warehouse_name.lower() for word in ["–∏—Ç–æ–≥", "–≤—Å–µ–≥–æ", "–æ–±—â–∏–π"]):
        return False
        
    # –ò—Å–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–æ–∫–∏ "–≤ –ø—É—Ç–∏"
    if "–≤ –ø—É—Ç–∏" in warehouse_name.lower():
        return False
        
    return True
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–ª–∞–¥–æ–≤
```python
VALID_WAREHOUSE_PATTERNS = [
    r'^[–ê-–Ø–∞-—è\s\-\(\)]+\d*$',  # –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤
    r'^[–ê-–Ø–∞-—è]+\s*\d*$',       # –ì–æ—Ä–æ–¥ + –Ω–æ–º–µ—Ä
    r'^[–ê-–Ø–∞-—è]+\s*\([–ê-–Ø–∞-—è\s]+\)$'  # –ì–æ—Ä–æ–¥ (—Ä–∞–π–æ–Ω)
]

def validate_warehouse_name(warehouse_name: str) -> bool:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∫–ª–∞–¥–∞."""
    import re
    
    if not warehouse_name:
        return False
        
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    for pattern in VALID_WAREHOUSE_PATTERNS:
        if re.match(pattern, warehouse_name):
            return True
            
    return False
```

### 3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ group_data_by_product()
```python
# –í –º–µ—Ç–æ–¥–µ group_data_by_product():
for warehouse in item["warehouses"]:
    warehouse_name = warehouse.get("warehouseName", "")
    quantity = warehouse.get("quantity", 0)
    
    # –î–û–ë–ê–í–ò–¢–¨ –§–ò–õ–¨–¢–†–ê–¶–ò–Æ:
    if warehouse_name and is_real_warehouse(warehouse_name):
        if validate_warehouse_name(warehouse_name):
            # –¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ —Å–∫–ª–∞–¥
            if warehouse_name not in group["warehouses"]:
                group["warehouses"][warehouse_name] = {
                    "stock": 0,
                    "orders": 0
                }
            group["warehouses"][warehouse_name]["stock"] += quantity
        else:
            logger.warning(f"Invalid warehouse name format: {warehouse_name}")
    else:
        logger.debug(f"Filtered out delivery status: {warehouse_name}")
```

### 4. –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
```python
def debug_warehouse_data(warehouse_data: List[Dict], source: str = "unknown"):
    """–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤."""
    logger.info(f"=== WAREHOUSE DATA DEBUG ({source}) ===")
    
    all_warehouse_names = set()
    for item in warehouse_data:
        for warehouse in item.get("warehouses", []):
            name = warehouse.get("warehouseName", "")
            if name:
                all_warehouse_names.add(name)
    
    logger.info(f"Total unique warehouse names: {len(all_warehouse_names)}")
    
    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø–∞–º
    real_warehouses = []
    delivery_statuses = []
    unknown = []
    
    for name in all_warehouse_names:
        if is_real_warehouse(name):
            if validate_warehouse_name(name):
                real_warehouses.append(name)
            else:
                unknown.append(name)
        else:
            delivery_statuses.append(name)
    
    logger.info(f"‚úÖ Real warehouses ({len(real_warehouses)}): {real_warehouses}")
    logger.warning(f"‚ö†Ô∏è Delivery statuses ({len(delivery_statuses)}): {delivery_statuses}")
    logger.error(f"‚ùå Unknown format ({len(unknown)}): {unknown}")
    
    return {
        "real_warehouses": real_warehouses,
        "delivery_statuses": delivery_statuses, 
        "unknown": unknown
    }
```

### 5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```python
# –í process_combined_api_data():
def process_combined_api_data(analytics_v2_data, warehouse_v1_data):
    # –î–û–ë–ê–í–ò–¢–¨ –≤ –Ω–∞—á–∞–ª–æ:
    logger.info("üîç Debugging warehouse data before processing...")
    debug_results = debug_warehouse_data(warehouse_v1_data, "Warehouse API v1")
    
    if not debug_results["real_warehouses"]:
        logger.error("‚ùå No real warehouses found in API data!")
        # –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        
    # –î–∞–ª–µ–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π...
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
```python
def test_delivery_status_filtering():
    test_data = [
        ("–¢—É–ª–∞", True),
        ("–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã", True), 
        ("–í –ø—É—Ç–∏ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π", False),
        ("–í –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å–∫–ª–∞–¥ WB", False),
        ("–í—Å–µ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö", False),
        ("–ü–æ–¥–æ–ª—å—Å–∫ 3", True),
        ("–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", True)
    ]
    
    for name, expected in test_data:
        result = is_real_warehouse(name)
        assert result == expected, f"Failed for {name}: expected {expected}, got {result}"
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤ –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∫–ª–∞–¥—ã
```python
def test_no_delivery_statuses_in_products():
    # –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–æ—Å—Ç–∞–≤–æ—á–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –Ω–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
    # –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°–∫–ª–∞–¥—ã –≤ —Ç–∞–±–ª–∏—Ü–µ:
‚ùå "–í –ø—É—Ç–∏ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π" - 3 –∑–∞–∫–∞–∑–∞, 55 –æ—Å—Ç–∞—Ç–∫–æ–≤
‚ùå "–í –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å–∫–ª–∞–¥ WB" - 0 –∑–∞–∫–∞–∑–æ–≤, 5 –æ—Å—Ç–∞—Ç–∫–æ–≤
‚ùå "–í—Å–µ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö" - 36 –∑–∞–∫–∞–∑–æ–≤, 547 –æ—Å—Ç–∞—Ç–∫–æ–≤
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°–∫–ª–∞–¥—ã –≤ —Ç–∞–±–ª–∏—Ü–µ:
‚úÖ "–¢—É–ª–∞" - 15 –∑–∞–∫–∞–∑–æ–≤, 200 –æ—Å—Ç–∞—Ç–∫–æ–≤
‚úÖ "–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã" - 12 –∑–∞–∫–∞–∑–æ–≤, 150 –æ—Å—Ç–∞—Ç–∫–æ–≤  
‚úÖ "–î–æ–º–æ–¥–µ–¥–æ–≤–æ" - 8 –∑–∞–∫–∞–∑–æ–≤, 100 –æ—Å—Ç–∞—Ç–∫–æ–≤
```

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

1. ‚úÖ –í Google Sheets –ù–ï–¢ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–ª–∞–¥–æ–≤
2. ‚úÖ –í—Å–µ —Å–∫–ª–∞–¥—ã –∏–º–µ—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤/—Ä–µ–≥–∏–æ–Ω–æ–≤  
3. ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
5. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ü–†–ò–û–†–ò–¢–ï–¢: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–π.